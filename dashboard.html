<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>Bhoomi — Dashboard</title>
    <link rel="icon" href="/images/favicon.ico" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Bhoomi — Agricultural Marketplace Dashboard" name="description">
    <meta content="agricultural dashboard, farmer dashboard, warehouse dashboard, manufacturer dashboard, Bhoomi dashboard" name="keywords">
    <meta content="" name="author">
    <!-- Gemini API Configuration -->
    <script src="gemini-config.js"></script>
    <!-- CSS Files -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/plugins.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/coloring.css" rel="stylesheet" type="text/css">
    <!-- color scheme -->
    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
</head>

<body>
    <div id="wrapper">
        <a href="#" id="back-to-top"></a>
        
        <!-- preloader begin -->
        <div id="de-loader"></div>
        <!-- preloader end -->

        <!-- header begin -->
        <header class="transparent">
            <div id="topbar">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between xs-hide">
                                <div class="d-flex">
                                    <div class="topbar-widget me-3"><a href="#"><i class="icofont-clock-time"></i> Monday - Friday (08.00 AM - 10.00 PM)</a></div>
                                    <div class="topbar-widget me-3"><a href="#"><i class="icofont-location-pin"></i>India</a></div>
                                    <div class="topbar-widget me-3"><a href="#"><i class="icofont-envelope"></i>bhoomi@yahoo.com</a></div>
                                </div>
                                <div class="d-flex">
                                    <div class="social-icons">
                                        <a href="#"><i class="fa-brands fa-facebook fa-lg"></i></a>
                                        <a href="#"><i class="fa-brands fa-x-twitter fa-lg"></i></a>
                                        <a href="#"><i class="fa-brands fa-youtube fa-lg"></i></a>
                                        <a href="#"><i class="fa-brands fa-pinterest fa-lg"></i></a>
                                        <a href="#"><i class="fa-brands fa-instagram fa-lg"></i></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <!-- logo begin -->
                                <div id="logo">
                                    <a href="index.html">
                                        <img class="logo-main" src="images/white.png" alt="">
                                        <img class="logo-mobile" src="images/white.png" alt="">
                                    </a>
                                </div>
                                <!-- logo end -->
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <!-- mainemenu begin -->
                                <ul id="mainmenu">
                                    <li><a class="menu-item" href="index.html">Home</a></li>
                                    <li><a class="menu-item" href="services.html">Services</a></li>
                                    <li><a class="menu-item" href="projects.html">Projects</a></li>
                                    <li><a class="menu-item" href="about.html">About</a></li>
                                    <li><a class="menu-item" href="contact.html">Contact</a></li>
                                </ul>
                                <!-- mainemenu end -->
                            </div>
                            <div class="de-flex-col">
                                <div class="menu_side_area">          
                                    <a href="#" class="btn-main btn-line me-2" onclick="logout()">Logout</a>
                                    <span id="menu-btn"></span>
                                </div>
                                <div id="btn-extra">
                                    <span></span>
                                    <span></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- header end -->

        <!-- content begin -->
        <div class="no-bottom no-top" id="content">
            <div id="top"></div>

            <section id="subheader" class="relative jarallax text-light">
                <img src="images/background/8.webp" class="jarallax-img" alt="">
                <div class="container relative z-index-1000">
                    <div class="row">
                        <div class="col-lg-6">
                            <ul class="crumb">
                                <li><a href="index.html">Home</a></li>
                                <li class="active">Dashboard</li>
                            </ul>
                            <h1 class="text-uppercase" id="dashboard-title">Dashboard</h1>
                            <p class="col-lg-10 lead" id="dashboard-subtitle">Welcome to your Bhoomi dashboard!</p>
                        </div>
                    </div>
                </div>
                <img src="images/logo-wm.webp" class="abs end-0 bottom-0 z-2 w-20" alt="">
                <div class="de-gradient-edge-top dark"></div>
                <div class="de-overlay"></div>
            </section>

            <!-- Farmer Dashboard -->
            <div id="farmer-dashboard" class="dashboard-content" style="display: none;">
                <section class="pt80 pb80">
                    <div class="container">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <h2 class="mb-4">Farmer <span class="id-color-2">Dashboard</span></h2>
                            </div>
                            
                            <!-- Stats Cards -->
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">12</h3>
                                    <p class="mb-0">Active Listings</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">₹2.5L</h3>
                                    <p class="mb-0">Total Earnings</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">8</h3>
                                    <p class="mb-0">Completed Orders</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">4.8</h3>
                                    <p class="mb-0">Rating</p>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="col-lg-12">
                                <h4 class="mb-4">Quick Actions</h4>
                                <div class="row g-4">
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showStockForm()">
                                            <i class="icofont-plus fs-48 mb-3"></i>
                                            <h5>List Your Byproducts</h5>
                                            <p class="mb-0">Add new stock to marketplace</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showMyListings()">
                                            <i class="icofont-list fs-48 mb-3"></i>
                                            <h5>My Stock Listings</h5>
                                            <p class="mb-0">View and manage your listings</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showMyInvoices()">
                                            <i class="icofont-file-text fs-48 mb-3"></i>
                                            <h5>My Invoices</h5>
                                            <p class="mb-0">View payment invoices</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showStorageRentalForm()">
                                            <i class="icofont-building fs-48 mb-3"></i>
                                            <h5>Rent Storage</h5>
                                            <p class="mb-0">Request storage space</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showMyStorageRentals()">
                                            <i class="icofont-list fs-48 mb-3"></i>
                                            <h5>My Rentals</h5>
                                            <p class="mb-0">Manage storage rentals</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showEarnings()">
                                            <i class="icofont-money-bag fs-48 mb-3"></i>
                                            <h5>View Earnings</h5>
                                            <p class="mb-0">Check your transaction history</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showWarehouses()">
                                            <i class="icofont-building fs-48 mb-3"></i>
                                            <h5>Find Warehouses</h5>
                                            <p class="mb-0">Connect with storage partners</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Stock Listing Form -->
                            <div id="stock-form-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">List Your Agricultural Byproducts</h4>
                                    <form id="stockForm" onsubmit="submitStockListing(event)">
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label">Crop Type *</label>
                                                <select class="form-control" name="cropType" required>
                                                    <option value="">Select Crop Type</option>
                                                    <option value="rice">Rice</option>
                                                    <option value="wheat">Wheat</option>
                                                    <option value="sugarcane">Sugarcane</option>
                                                    <option value="cotton">Cotton</option>
                                                    <option value="maize">Maize</option>
                                                    <option value="soybean">Soybean</option>
                                                    <option value="mustard">Mustard</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Byproduct Type *</label>
                                                <select class="form-control" name="byproductType" required>
                                                    <option value="">Select Byproduct Type</option>
                                                    <option value="rice-husk">Rice Husk</option>
                                                    <option value="wheat-straw">Wheat Straw</option>
                                                    <option value="bagasse">Bagasse</option>
                                                    <option value="cotton-stalks">Cotton Stalks</option>
                                                    <option value="corn-cobs">Corn Cobs</option>
                                                    <option value="soybean-hulls">Soybean Hulls</option>
                                                    <option value="mustard-straw">Mustard Straw</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Quantity Available *</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="quantity" step="0.1" required>
                                                    <select class="form-control" name="quantityUnit" required>
                                                        <option value="tons">Tons</option>
                                                        <option value="quintals">Quintals</option>
                                                        <option value="kg">Kilograms</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Quality Grade *</label>
                                                <select class="form-control" name="qualityGrade" required>
                                                    <option value="">Select Quality Grade</option>
                                                    <option value="premium">Premium (A Grade)</option>
                                                    <option value="standard">Standard (B Grade)</option>
                                                    <option value="basic">Basic (C Grade)</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Harvest Date *</label>
                                                <input type="date" class="form-control" name="harvestDate" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Storage Location/Address *</label>
                                                <input type="text" class="form-control" name="storageLocation" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Expected Price Range (Min) *</label>
                                                <input type="number" class="form-control" name="minPrice" step="0.01" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Expected Price Range (Max) *</label>
                                                <input type="number" class="form-control" name="maxPrice" step="0.01" required>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Additional Notes</label>
                                                <textarea class="form-control" name="notes" rows="3" placeholder="Any additional information about the byproduct..."></textarea>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Photos Upload</label>
                                                <input type="file" class="form-control" name="photos" accept="image/*" multiple>
                                                <small class="text-muted">Upload up to 5 photos of your byproduct</small>
                                            </div>
                                            <div class="col-12 text-center">
                                                <button type="submit" class="btn-main">Submit Stock Listing</button>
                                                <button type="button" class="btn-main btn-line ms-2" onclick="hideStockForm()">Cancel</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- My Stock Listings -->
                            <div id="my-listings-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">My Stock Listings</h4>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Crop Type</th>
                                                    <th>Byproduct</th>
                                                    <th>Quantity</th>
                                                    <th>Quality</th>
                                                    <th>Price Range</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="myListingsTable">
                                                <!-- Dynamic content will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- My Invoices -->
                            <div id="my-invoices-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h4 class="mb-0">My Invoices</h4>
                                        <div class="d-flex gap-2">
                                            <input type="text" id="searchInvoices" class="form-control" placeholder="Search invoices..." style="width: 200px;">
                                            <select id="filterInvoiceStatus" class="form-control" style="width: 150px;">
                                                <option value="">All Status</option>
                                                <option value="pending">Pending</option>
                                                <option value="paid">Paid</option>
                                                <option value="overdue">Overdue</option>
                                                <option value="cancelled">Cancelled</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- Invoice Summary Cards -->
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-3">
                                            <div class="bg-white p-3 rounded border">
                                                <h6 class="text-muted mb-1">Total Invoices</h6>
                                                <h4 class="text-primary mb-0" id="totalInvoicesCount">0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="bg-white p-3 rounded border">
                                                <h6 class="text-muted mb-1">Total Amount</h6>
                                                <h4 class="text-success mb-0" id="totalInvoiceAmount">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="bg-white p-3 rounded border">
                                                <h6 class="text-muted mb-1">Amount Received</h6>
                                                <h4 class="text-success mb-0" id="amountReceived">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="bg-white p-3 rounded border">
                                                <h6 class="text-muted mb-1">Pending Amount</h6>
                                                <h4 class="text-warning mb-0" id="pendingAmount">₹0</h4>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Invoice No.</th>
                                                    <th>Date</th>
                                                    <th>Warehouse</th>
                                                    <th>Commodity</th>
                                                    <th>Quantity</th>
                                                    <th>Rate/Unit</th>
                                                    <th>Gross Amount</th>
                                                    <th>GST Amount</th>
                                                    <th>TDS Deducted</th>
                                                    <th>Commission</th>
                                                    <th>Net Amount</th>
                                                    <th>Payment Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="myInvoicesTable">
                                                <!-- Dynamic content will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Storage Rental Request Form -->
                            <div id="storage-rental-form-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">Request Storage Rental</h4>
                                    <form id="storageRentalForm" onsubmit="submitStorageRentalRequest(event)">
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label">Storage Duration *</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="duration" min="1" required>
                                                    <select class="form-control" name="durationUnit" required>
                                                        <option value="days">Days</option>
                                                        <option value="months">Months</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Required Storage Area *</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="storageArea" step="0.1" min="1" required>
                                                    <select class="form-control" name="areaUnit" required>
                                                        <option value="sqft">Square Feet</option>
                                                        <option value="cubicm">Cubic Meters</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Commodity Type *</label>
                                                <select class="form-control" name="commodityType" required>
                                                    <option value="">Select Commodity</option>
                                                    <option value="rice-husk">Rice Husk</option>
                                                    <option value="wheat-straw">Wheat Straw</option>
                                                    <option value="bagasse">Bagasse</option>
                                                    <option value="cotton-stalks">Cotton Stalks</option>
                                                    <option value="corn-cobs">Corn Cobs</option>
                                                    <option value="soybean-hulls">Soybean Hulls</option>
                                                    <option value="mustard-straw">Mustard Straw</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Quantity to Store *</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="quantity" step="0.1" min="1" required>
                                                    <select class="form-control" name="quantityUnit" required>
                                                        <option value="tons">Tons</option>
                                                        <option value="quintals">Quintals</option>
                                                        <option value="kg">Kilograms</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Expected Storage Start Date *</label>
                                                <input type="date" class="form-control" name="startDate" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Rental Budget (per month) *</label>
                                                <input type="number" class="form-control" name="budget" step="0.01" min="0" required>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Special Storage Requirements</label>
                                                <div class="row g-2">
                                                    <div class="col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" name="temperatureControl" value="yes">
                                                            <label class="form-check-label">Temperature Control</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" name="moistureProtection" value="yes">
                                                            <label class="form-check-label">Moisture Protection</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" name="pestControl" value="yes">
                                                            <label class="form-check-label">Pest Control</label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Additional Requirements</label>
                                                <textarea class="form-control" name="additionalRequirements" rows="3" placeholder="Any specific storage requirements, handling needs, or special instructions..."></textarea>
                                            </div>
                                            <div class="col-12 text-center">
                                                <button type="submit" class="btn-main">Submit Rental Request</button>
                                                <button type="button" class="btn-main btn-line ms-2" onclick="hideStorageRentalForm()">Cancel</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- My Storage Rentals -->
                            <div id="my-storage-rentals-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">My Storage Rentals</h4>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Rental ID</th>
                                                    <th>Commodity</th>
                                                    <th>Area</th>
                                                    <th>Duration</th>
                                                    <th>Start Date</th>
                                                    <th>Monthly Rate</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="myStorageRentalsTable">
                                                <!-- Dynamic content will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="col-lg-8">
                                <h4 class="mb-4">Recent Activity</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Rice Husk - 50 tons</h6>
                                            <p class="text-muted mb-0">Sold to Biofuel Corp</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-success">₹25,000</span>
                                            <br><small class="text-muted">2 days ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Wheat Straw - 30 tons</h6>
                                            <p class="text-muted mb-0">New inquiry from Feed Mill</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-warning">Pending</span>
                                            <br><small class="text-muted">1 day ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Cotton Waste - 20 tons</h6>
                                            <p class="text-muted mb-0">Listed successfully</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-info">Active</span>
                                            <br><small class="text-muted">3 days ago</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Notifications -->
                            <div class="col-lg-4">
                                <h4 class="mb-4">Notifications</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex align-items-start mb-3">
                                        <i class="icofont-bell text-color me-3 mt-1"></i>
                                        <div>
                                            <h6 class="mb-1">New Inquiry</h6>
                                            <p class="text-muted mb-0">You have 3 new inquiries for your listings</p>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start mb-3">
                                        <i class="icofont-money text-color me-3 mt-1"></i>
                                        <div>
                                            <h6 class="mb-1">Payment Received</h6>
                                            <p class="text-muted mb-0">₹25,000 credited to your account</p>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start">
                                        <i class="icofont-truck text-color me-3 mt-1"></i>
                                        <div>
                                            <h6 class="mb-1">Delivery Scheduled</h6>
                                            <p class="text-muted mb-0">Pickup scheduled for tomorrow</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Warehouse Dashboard -->
            <div id="warehouse-dashboard" class="dashboard-content" style="display: none;">
                <section class="pt80 pb80">
                    <div class="container">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <h2 class="mb-4">Warehouse Partner <span class="id-color-2">Dashboard</span></h2>
                            </div>
                            
                            <!-- Stats Cards -->
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">5</h3>
                                    <p class="mb-0">Active Partnerships</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">₹1.2L</h3>
                                    <p class="mb-0">Monthly Revenue</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">85%</h3>
                                    <p class="mb-0">Storage Utilization</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">12</h3>
                                    <p class="mb-0">Total Orders</p>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="col-lg-12">
                                <h4 class="mb-4">Quick Actions</h4>
                                <div class="row g-4">
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showDualManagement()">
                                            <i class="icofont-list fs-48 mb-3"></i>
                                            <h5>Manage Requests</h5>
                                            <p class="mb-0">Stock & Requirements</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showGeneratedInvoices()">
                                            <i class="icofont-file-text fs-48 mb-3"></i>
                                            <h5>Generated Invoices</h5>
                                            <p class="mb-0">Track farmer payments</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showStorageRentalManagement()">
                                            <i class="icofont-building fs-48 mb-3"></i>
                                            <h5>Storage Rentals</h5>
                                            <p class="mb-0">Manage rental income</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showStorageManagement()">
                                            <i class="icofont-building fs-48 mb-3"></i>
                                            <h5>Manage Storage</h5>
                                            <p class="mb-0">Update storage capacity</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showPartnerships()">
                                            <i class="icofont-handshake-deal fs-48 mb-3"></i>
                                            <h5>New Partnerships</h5>
                                            <p class="mb-0">Connect with farmers</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showEarnings()">
                                            <i class="icofont-money-bag fs-48 mb-3"></i>
                                            <h5>View Earnings</h5>
                                            <p class="mb-0">Check rental income</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Dual Management System -->
                            <div id="dual-management-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <!-- Tab Navigation -->
                                    <ul class="nav nav-tabs mb-4" id="managementTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="stock-requests-tab" data-bs-toggle="tab" data-bs-target="#stock-requests-pane" type="button" role="tab">
                                                <i class="icofont-farmer me-2"></i>Farmer Stock Requests
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="industry-requirements-tab" data-bs-toggle="tab" data-bs-target="#industry-requirements-pane" type="button" role="tab">
                                                <i class="icofont-factory me-2"></i>Industry Requirements
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Tab Content -->
                                    <div class="tab-content" id="managementTabContent">
                                        <!-- Farmer Stock Requests Tab -->
                                        <div class="tab-pane fade show active" id="stock-requests-pane" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5>Incoming Stock Requests from Farmers</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="text" class="form-control" id="searchStockRequests" placeholder="Search stock requests..." style="width: 200px;">
                                                    <select class="form-control" id="filterStockStatus" style="width: 150px;">
                                                        <option value="">All Status</option>
                                                        <option value="pending">Pending</option>
                                                        <option value="accepted">Accepted</option>
                                                        <option value="rejected">Rejected</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Farmer</th>
                                                            <th>Crop Type</th>
                                                            <th>Byproduct</th>
                                                            <th>Quantity</th>
                                                            <th>Quality</th>
                                                            <th>Location</th>
                                                            <th>Price Range</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="stockRequestsTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Industry Requirements Tab -->
                                        <div class="tab-pane fade" id="industry-requirements-pane" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5>Industry Raw Material Requirements</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="text" class="form-control" id="searchIndustryRequests" placeholder="Search requirements..." style="width: 200px;">
                                                    <select class="form-control" id="filterIndustryStatus" style="width: 150px;">
                                                        <option value="">All Status</option>
                                                        <option value="pending">Pending</option>
                                                        <option value="accepted">Accepted</option>
                                                        <option value="rejected">Rejected</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Company</th>
                                                            <th>Material Type</th>
                                                            <th>Quantity</th>
                                                            <th>Quality</th>
                                                            <th>Delivery Date</th>
                                                            <th>Budget Range</th>
                                                            <th>Urgency</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="industryRequirementsTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Generated Invoices -->
                            <div id="generated-invoices-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h4 class="mb-0">Generated Invoices</h4>
                                        <div class="d-flex gap-2">
                                            <input type="text" id="searchGeneratedInvoices" class="form-control" placeholder="Search invoices..." style="width: 200px;">
                                            <select id="filterGeneratedInvoiceStatus" class="form-control" style="width: 150px;">
                                                <option value="">All Status</option>
                                                <option value="pending">Pending Payment</option>
                                                <option value="approved">Approved</option>
                                                <option value="paid">Paid</option>
                                                <option value="overdue">Overdue</option>
                                            </select>
                                            <button class="btn btn-success" onclick="generateBulkPaymentReport()">
                                                <i class="icofont-file-excel"></i> Export Report
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Invoice Summary Dashboard -->
                                    <div class="row g-3 mb-4">
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">Total Invoices</h6>
                                                <h4 class="text-primary mb-0" id="totalGeneratedInvoices">0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">Total Amount</h6>
                                                <h4 class="text-success mb-0" id="totalGeneratedAmount">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">Commission Earned</h6>
                                                <h4 class="text-info mb-0" id="totalCommissionEarned">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">TDS Collected</h6>
                                                <h4 class="text-warning mb-0" id="totalTDSCollected">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">GST Collected</h6>
                                                <h4 class="text-secondary mb-0" id="totalGSTCollected">₹0</h4>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="bg-white p-3 rounded border text-center">
                                                <h6 class="text-muted mb-1">Net Payable</h6>
                                                <h4 class="text-success mb-0" id="totalNetPayable">₹0</h4>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Invoice No.</th>
                                                    <th>Date</th>
                                                    <th>Farmer</th>
                                                    <th>Commodity</th>
                                                    <th>Quantity</th>
                                                    <th>Rate/Unit</th>
                                                    <th>Gross Amount</th>
                                                    <th>GST</th>
                                                    <th>TDS</th>
                                                    <th>Commission</th>
                                                    <th>Net Payable</th>
                                                    <th>Payment Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="generatedInvoicesTable">
                                                <!-- Dynamic content will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <!-- Bulk Actions -->
                                    <div class="mt-4 p-3 bg-white rounded border">
                                        <h6 class="mb-3">Bulk Actions</h6>
                                        <div class="d-flex gap-2 flex-wrap">
                                            <button class="btn btn-outline-success" onclick="approveBulkInvoices()">
                                                <i class="icofont-check-circled"></i> Approve Selected
                                            </button>
                                            <button class="btn btn-outline-info" onclick="markBulkAsPaid()">
                                                <i class="icofont-money"></i> Mark as Paid
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="downloadBulkInvoices()">
                                                <i class="icofont-download"></i> Download Selected
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="sendPaymentReminders()">
                                                <i class="icofont-notification"></i> Send Reminders
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Invoice Details Modal -->
                            <div id="invoice-details-modal" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h4 class="mb-0">Invoice Details</h4>
                                        <button class="btn btn-outline-secondary" onclick="hideInvoiceDetails()">
                                            <i class="icofont-close"></i> Close
                                        </button>
                                    </div>
                                    
                                    <div id="invoice-details-content">
                                        <!-- Invoice content will be loaded here -->
                                    </div>
                                    
                                    <div class="mt-4 d-flex gap-2 justify-content-end">
                                        <button class="btn btn-success" onclick="downloadCurrentInvoice()">
                                            <i class="icofont-download"></i> Download PDF
                                        </button>
                                        <button class="btn btn-info" onclick="printCurrentInvoice()">
                                            <i class="icofont-printer"></i> Print
                                        </button>
                                        <button class="btn btn-primary" onclick="emailCurrentInvoice()">
                                            <i class="icofont-email"></i> Email
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Storage Rental Management -->
                            <div id="storage-rental-management-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <!-- Tab Navigation -->
                                    <ul class="nav nav-tabs mb-4" id="rentalTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="rental-requests-tab" data-bs-toggle="tab" data-bs-target="#rental-requests-pane" type="button" role="tab">
                                                <i class="icofont-farmer me-2"></i>Rental Requests
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="active-rentals-tab" data-bs-toggle="tab" data-bs-target="#active-rentals-pane" type="button" role="tab">
                                                <i class="icofont-building me-2"></i>Active Rentals
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="rental-income-tab" data-bs-toggle="tab" data-bs-target="#rental-income-pane" type="button" role="tab">
                                                <i class="icofont-chart-line me-2"></i>Rental Income
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Tab Content -->
                                    <div class="tab-content" id="rentalTabContent">
                                        <!-- Rental Requests Tab -->
                                        <div class="tab-pane fade show active" id="rental-requests-pane" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5>Storage Rental Requests</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="text" class="form-control" id="searchRentalRequests" placeholder="Search requests..." style="width: 200px;">
                                                    <select class="form-control" id="filterRentalStatus" style="width: 150px;">
                                                        <option value="">All Status</option>
                                                        <option value="pending">Pending</option>
                                                        <option value="accepted">Accepted</option>
                                                        <option value="rejected">Rejected</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Farmer</th>
                                                            <th>Commodity</th>
                                                            <th>Area</th>
                                                            <th>Duration</th>
                                                            <th>Start Date</th>
                                                            <th>Budget</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rentalRequestsTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Active Rentals Tab -->
                                        <div class="tab-pane fade" id="active-rentals-pane" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5>Active Storage Rentals</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="text" class="form-control" id="searchActiveRentals" placeholder="Search rentals..." style="width: 200px;">
                                                    <select class="form-control" id="filterRentalType" style="width: 150px;">
                                                        <option value="">All Types</option>
                                                        <option value="active">Active</option>
                                                        <option value="expiring">Expiring Soon</option>
                                                        <option value="overdue">Overdue</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Rental ID</th>
                                                            <th>Farmer</th>
                                                            <th>Commodity</th>
                                                            <th>Area</th>
                                                            <th>Monthly Rate</th>
                                                            <th>End Date</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="activeRentalsTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Rental Income Tab -->
                                        <div class="tab-pane fade" id="rental-income-pane" role="tabpanel">
                                            <div class="row g-4 mb-4">
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="monthlyRentalIncome">₹0</h3>
                                                        <p class="mb-0">Monthly Rental Income</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="quarterlyRentalIncome">₹0</h3>
                                                        <p class="mb-0">Quarterly Income</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="activeRentalCount">0</h3>
                                                        <p class="mb-0">Active Rentals</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="totalRentalSpace">0</h3>
                                                        <p class="mb-0">Total Rented Space (sq ft)</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Rental ID</th>
                                                            <th>Farmer</th>
                                                            <th>Commodity</th>
                                                            <th>Area</th>
                                                            <th>Monthly Rate</th>
                                                            <th>Total Revenue</th>
                                                            <th>Commission</th>
                                                            <th>Net Income</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="rentalIncomeTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                             <!-- Storage Overview -->
                            <div class="col-lg-8">
                                <h4 class="mb-4">Storage Overview</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <h6>Rice Husk Storage</h6>
                                            <div class="progress mb-2">
                                                <div class="progress-bar" style="width: 75%"></div>
                                            </div>
                                            <small class="text-muted">150/200 tons</small>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Wheat Straw Storage</h6>
                                            <div class="progress mb-2">
                                                <div class="progress-bar" style="width: 60%"></div>
                                            </div>
                                            <small class="text-muted">90/150 tons</small>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Cotton Waste Storage</h6>
                                            <div class="progress mb-2">
                                                <div class="progress-bar" style="width: 40%"></div>
                                            </div>
                                            <small class="text-muted">40/100 tons</small>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Bagasse Storage</h6>
                                            <div class="progress mb-2">
                                                <div class="progress-bar" style="width: 90%"></div>
                                            </div>
                                            <small class="text-muted">180/200 tons</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Orders -->
                            <div class="col-lg-4">
                                <h4 class="mb-4">Recent Orders</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Rice Husk - 50 tons</h6>
                                            <p class="text-muted mb-0">From Rajesh Kumar</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-success">Stored</span>
                                            <br><small class="text-muted">2 days ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Wheat Straw - 30 tons</h6>
                                            <p class="text-muted mb-0">From Priya Sharma</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-warning">In Transit</span>
                                            <br><small class="text-muted">1 day ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Cotton Waste - 20 tons</h6>
                                            <p class="text-muted mb-0">From Amit Patel</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-info">Scheduled</span>
                                            <br><small class="text-muted">Tomorrow</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Manufacturer Dashboard -->
            <div id="manufacturer-dashboard" class="dashboard-content" style="display: none;">
                <section class="pt80 pb80">
                    <div class="container">
                        <div class="row g-4">
                            <div class="col-lg-12">
                                <h2 class="mb-4">Manufacturer <span class="id-color-2">Dashboard</span></h2>
                            </div>
                            
                            <!-- Stats Cards -->
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">25</h3>
                                    <p class="mb-0">Active Suppliers</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">₹5.2L</h3>
                                    <p class="mb-0">Monthly Savings</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">18</h3>
                                    <p class="mb-0">Completed Orders</p>
                                </div>
                            </div>
                            <div class="col-lg-3 col-md-6">
                                <div class="bg-light padding30 rounded-1 text-center">
                                    <h3 class="text-color">4.9</h3>
                                    <p class="mb-0">Quality Rating</p>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="col-lg-12">
                                <h4 class="mb-4">Quick Actions</h4>
                                <div class="row g-4">
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showRequirementForm()">
                                            <i class="icofont-plus fs-48 mb-3"></i>
                                            <h5>Post Requirement</h5>
                                            <p class="mb-0">Request raw materials</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showMyRequirements()">
                                            <i class="icofont-list fs-48 mb-3"></i>
                                            <h5>My Requirements</h5>
                                            <p class="mb-0">Manage your requests</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showFindSuppliers()">
                                            <i class="icofont-search-1 fs-48 mb-3"></i>
                                            <h5>Find Suppliers</h5>
                                            <p class="mb-0">Search for byproducts</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showAnalytics()">
                                            <i class="icofont-chart-line fs-48 mb-3"></i>
                                            <h5>Analytics</h5>
                                            <p class="mb-0">View sourcing metrics</p>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-6">
                                        <div class="bg-color text-light padding30 rounded-1 text-center hover" onclick="showExportManagement()">
                                            <i class="icofont-ship fs-48 mb-3"></i>
                                            <h5>Export Management</h5>
                                            <p class="mb-0">International exports</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Requirement Posting Form -->
                            <div id="requirement-form-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">Post Raw Material Requirement</h4>
                                    <form id="requirementForm" onsubmit="submitRequirement(event)">
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label">Raw Material Type *</label>
                                                <select class="form-control" name="materialType" required>
                                                    <option value="">Select Raw Material</option>
                                                    <option value="rice-husk">Rice Husk</option>
                                                    <option value="wheat-straw">Wheat Straw</option>
                                                    <option value="bagasse">Bagasse</option>
                                                    <option value="cotton-stalks">Cotton Stalks</option>
                                                    <option value="corn-cobs">Corn Cobs</option>
                                                    <option value="soybean-hulls">Soybean Hulls</option>
                                                    <option value="mustard-straw">Mustard Straw</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Required Quantity *</label>
                                                <div class="input-group">
                                                    <input type="number" class="form-control" name="quantity" step="0.1" required>
                                                    <select class="form-control" name="quantityUnit" required>
                                                        <option value="tons">Tons</option>
                                                        <option value="quintals">Quintals</option>
                                                        <option value="kg">Kilograms</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Quality Specifications *</label>
                                                <select class="form-control" name="qualitySpecs" required>
                                                    <option value="">Select Quality Level</option>
                                                    <option value="premium">Premium - High quality, clean, processed</option>
                                                    <option value="standard">Standard - Good quality, minimal processing</option>
                                                    <option value="basic">Basic - Acceptable quality, raw form</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Required Delivery Date *</label>
                                                <input type="date" class="form-control" name="deliveryDate" required>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Delivery Location/Address *</label>
                                                <textarea class="form-control" name="deliveryLocation" rows="2" required></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Budget Range (Min) per Unit *</label>
                                                <input type="number" class="form-control" name="minBudget" step="0.01" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Budget Range (Max) per Unit *</label>
                                                <input type="number" class="form-control" name="maxBudget" step="0.01" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Industry Use Case *</label>
                                                <select class="form-control" name="industryUse" required>
                                                    <option value="">Select Industry Use</option>
                                                    <option value="biofuel">Biofuel Production</option>
                                                    <option value="packaging">Packaging Materials</option>
                                                    <option value="pharmaceuticals">Pharmaceuticals</option>
                                                    <option value="construction">Construction Materials</option>
                                                    <option value="textile">Textile Manufacturing</option>
                                                    <option value="paper">Paper Production</option>
                                                    <option value="animal-feed">Animal Feed</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Urgency Level *</label>
                                                <select class="form-control" name="urgencyLevel" required>
                                                    <option value="">Select Urgency</option>
                                                    <option value="urgent">Urgent - Within 1 week</option>
                                                    <option value="normal">Normal - Within 2-4 weeks</option>
                                                    <option value="flexible">Flexible - 1+ months</option>
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Special Requirements/Notes</label>
                                                <textarea class="form-control" name="specialRequirements" rows="3" placeholder="Any specific requirements, processing needs, or additional notes..."></textarea>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Company Purchase Order Number</label>
                                                <input type="text" class="form-control" name="purchaseOrderNumber">
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Contact Person for Procurement</label>
                                                <input type="text" class="form-control" name="contactPerson" required>
                                            </div>
                                            <div class="col-12 text-center">
                                                <button type="submit" class="btn-main">Submit Requirement</button>
                                                <button type="button" class="btn-main btn-line ms-2" onclick="hideRequirementForm()">Cancel</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- My Requirements -->
                            <div id="my-requirements-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <h4 class="mb-4">My Raw Material Requirements</h4>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Material Type</th>
                                                    <th>Quantity</th>
                                                    <th>Quality</th>
                                                    <th>Delivery Date</th>
                                                    <th>Budget Range</th>
                                                    <th>Urgency</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="myRequirementsTable">
                                                <!-- Dynamic content will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Export Management -->
                            <div id="export-management-section" class="col-lg-12" style="display: none;">
                                <div class="bg-light padding30 rounded-1">
                                    <!-- Tab Navigation -->
                                    <ul class="nav nav-tabs mb-4" id="exportTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="create-export-tab" data-bs-toggle="tab" data-bs-target="#create-export-pane" type="button" role="tab">
                                                <i class="icofont-plus me-2"></i>Create Export Order
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="export-orders-tab" data-bs-toggle="tab" data-bs-target="#export-orders-pane" type="button" role="tab">
                                                <i class="icofont-list me-2"></i>Export Orders
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="export-docs-tab" data-bs-toggle="tab" data-bs-target="#export-docs-pane" type="button" role="tab">
                                                <i class="icofont-file-text me-2"></i>Export Documents
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="compliance-tab" data-bs-toggle="tab" data-bs-target="#compliance-pane" type="button" role="tab">
                                                <i class="icofont-shield me-2"></i>Compliance & Legal
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="export-analytics-tab" data-bs-toggle="tab" data-bs-target="#export-analytics-pane" type="button" role="tab">
                                                <i class="icofont-chart-line me-2"></i>Export Analytics
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Tab Content -->
                                    <div class="tab-content" id="exportTabContent">
                                        <!-- Create Export Order Tab -->
                                        <div class="tab-pane fade show active" id="create-export-pane" role="tabpanel">
                                            <h4 class="mb-4">Create Export Order</h4>
                                            <form id="exportOrderForm" onsubmit="submitExportOrder(event)">
                                                <div class="row g-4">
                                                    <!-- International Buyer Details -->
                                                    <div class="col-12">
                                                        <h5 class="mb-3">International Buyer Details</h5>
                                                        <div class="row g-4">
                                                            <div class="col-md-6">
                                                                <label class="form-label">Company Name *</label>
                                                                <input type="text" class="form-control" name="buyerCompany" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Country *</label>
                                                                <select class="form-control" name="buyerCountry" required>
                                                                    <option value="">Select Country</option>
                                                                    <option value="US">United States</option>
                                                                    <option value="UK">United Kingdom</option>
                                                                    <option value="DE">Germany</option>
                                                                    <option value="FR">France</option>
                                                                    <option value="IT">Italy</option>
                                                                    <option value="ES">Spain</option>
                                                                    <option value="NL">Netherlands</option>
                                                                    <option value="BE">Belgium</option>
                                                                    <option value="AU">Australia</option>
                                                                    <option value="CA">Canada</option>
                                                                    <option value="JP">Japan</option>
                                                                    <option value="KR">South Korea</option>
                                                                    <option value="SG">Singapore</option>
                                                                    <option value="AE">UAE</option>
                                                                    <option value="SA">Saudi Arabia</option>
                                                                    <option value="other">Other</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-12">
                                                                <label class="form-label">Complete Address *</label>
                                                                <textarea class="form-control" name="buyerAddress" rows="2" required></textarea>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Contact Person *</label>
                                                                <input type="text" class="form-control" name="buyerContact" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Email Address *</label>
                                                                <input type="email" class="form-control" name="buyerEmail" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Phone Number *</label>
                                                                <input type="tel" class="form-control" name="buyerPhone" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Tax ID/VAT Number</label>
                                                                <input type="text" class="form-control" name="buyerTaxId">
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Export Commodity Information -->
                                                    <div class="col-12">
                                                        <h5 class="mb-3">Export Commodity Information</h5>
                                                        <div class="row g-4">
                                                            <div class="col-md-6">
                                                                <label class="form-label">Byproduct Type *</label>
                                                                <select class="form-control" name="commodityType" required>
                                                                    <option value="">Select Commodity</option>
                                                                    <option value="rice-husk">Rice Husk</option>
                                                                    <option value="wheat-straw">Wheat Straw</option>
                                                                    <option value="bagasse">Bagasse</option>
                                                                    <option value="cotton-stalks">Cotton Stalks</option>
                                                                    <option value="corn-cobs">Corn Cobs</option>
                                                                    <option value="soybean-hulls">Soybean Hulls</option>
                                                                    <option value="mustard-straw">Mustard Straw</option>
                                                                    <option value="other">Other</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Quantity *</label>
                                                                <div class="input-group">
                                                                    <input type="number" class="form-control" name="quantity" step="0.1" min="1" required>
                                                                    <select class="form-control" name="quantityUnit" required>
                                                                        <option value="MT">Metric Tons</option>
                                                                        <option value="KG">Kilograms</option>
                                                                        <option value="LB">Pounds</option>
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Quality Grade *</label>
                                                                <select class="form-control" name="qualityGrade" required>
                                                                    <option value="">Select Quality Grade</option>
                                                                    <option value="premium">Premium (A Grade)</option>
                                                                    <option value="standard">Standard (B Grade)</option>
                                                                    <option value="basic">Basic (C Grade)</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">HS Code *</label>
                                                                <input type="text" class="form-control" name="hsCode" placeholder="e.g., 1213.00.00" required>
                                                            </div>
                                                            <div class="col-12">
                                                                <label class="form-label">Detailed Commodity Description *</label>
                                                                <textarea class="form-control" name="commodityDescription" rows="3" required></textarea>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Export Terms -->
                                                    <div class="col-12">
                                                        <h5 class="mb-3">Export Terms</h5>
                                                        <div class="row g-4">
                                                            <div class="col-md-4">
                                                                <label class="form-label">Incoterms *</label>
                                                                <select class="form-control" name="incoterms" required>
                                                                    <option value="">Select Incoterms</option>
                                                                    <option value="FOB">FOB (Free on Board)</option>
                                                                    <option value="CIF">CIF (Cost, Insurance & Freight)</option>
                                                                    <option value="EXW">EXW (Ex Works)</option>
                                                                    <option value="FCA">FCA (Free Carrier)</option>
                                                                    <option value="CPT">CPT (Carriage Paid To)</option>
                                                                    <option value="CIP">CIP (Carriage & Insurance Paid)</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label">Payment Terms *</label>
                                                                <select class="form-control" name="paymentTerms" required>
                                                                    <option value="">Select Payment Terms</option>
                                                                    <option value="LC">Letter of Credit</option>
                                                                    <option value="TT">Telegraphic Transfer</option>
                                                                    <option value="CAD">Cash Against Documents</option>
                                                                    <option value="DP">Documents Against Payment</option>
                                                                    <option value="DA">Documents Against Acceptance</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label class="form-label">Currency *</label>
                                                                <select class="form-control" name="currency" required>
                                                                    <option value="USD">USD (US Dollar)</option>
                                                                    <option value="EUR">EUR (Euro)</option>
                                                                    <option value="GBP">GBP (British Pound)</option>
                                                                    <option value="JPY">JPY (Japanese Yen)</option>
                                                                    <option value="AUD">AUD (Australian Dollar)</option>
                                                                    <option value="CAD">CAD (Canadian Dollar)</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Unit Price *</label>
                                                                <input type="number" class="form-control" name="unitPrice" step="0.01" min="0" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Delivery Timeline (Days) *</label>
                                                                <input type="number" class="form-control" name="deliveryTimeline" min="1" required>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Destination Port Details -->
                                                    <div class="col-12">
                                                        <h5 class="mb-3">Destination Port Details</h5>
                                                        <div class="row g-4">
                                                            <div class="col-md-6">
                                                                <label class="form-label">Destination Port *</label>
                                                                <input type="text" class="form-control" name="destinationPort" required>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Origin Port *</label>
                                                                <select class="form-control" name="originPort" required>
                                                                    <option value="">Select Origin Port</option>
                                                                    <option value="Mumbai">Mumbai (JNPT)</option>
                                                                    <option value="Chennai">Chennai</option>
                                                                    <option value="Kolkata">Kolkata</option>
                                                                    <option value="Kochi">Kochi</option>
                                                                    <option value="Mangalore">Mangalore</option>
                                                                    <option value="Tuticorin">Tuticorin</option>
                                                                    <option value="Kandla">Kandla</option>
                                                                    <option value="Mundra">Mundra</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Shipping Line</label>
                                                                <input type="text" class="form-control" name="shippingLine">
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label class="form-label">Container Type</label>
                                                                <select class="form-control" name="containerType">
                                                                    <option value="">Select Container Type</option>
                                                                    <option value="20ft">20ft Container</option>
                                                                    <option value="40ft">40ft Container</option>
                                                                    <option value="40ft-hc">40ft High Cube</option>
                                                                    <option value="bulk">Bulk Carrier</option>
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- Special Export Requirements -->
                                                    <div class="col-12">
                                                        <h5 class="mb-3">Special Export Requirements</h5>
                                                        <div class="row g-4">
                                                            <div class="col-12">
                                                                <label class="form-label">Required Certifications</label>
                                                                <div class="row g-2">
                                                                    <div class="col-md-3">
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" type="checkbox" name="fssaiCert" value="yes">
                                                                            <label class="form-check-label">FSSAI Certificate</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" type="checkbox" name="phytosanitaryCert" value="yes">
                                                                            <label class="form-check-label">Phyto-sanitary Certificate</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" type="checkbox" name="certificateOfOrigin" value="yes">
                                                                            <label class="form-check-label">Certificate of Origin</label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-3">
                                                                        <div class="form-check">
                                                                            <input class="form-check-input" type="checkbox" name="qualityCert" value="yes">
                                                                            <label class="form-check-label">Quality Certificate</label>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-12">
                                                                <label class="form-label">Additional Requirements</label>
                                                                <textarea class="form-control" name="additionalRequirements" rows="3" placeholder="Any special handling, packaging, or documentation requirements..."></textarea>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="col-12 text-center">
                                                        <button type="submit" class="btn-main">Create Export Order</button>
                                                        <button type="button" class="btn-main btn-line ms-2" onclick="hideExportManagement()">Cancel</button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>

                                        <!-- Export Orders Tab -->
                                        <div class="tab-pane fade" id="export-orders-pane" role="tabpanel">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h5>Export Orders</h5>
                                                <div class="d-flex gap-2">
                                                    <input type="text" class="form-control" id="searchExportOrders" placeholder="Search orders..." style="width: 200px;">
                                                    <select class="form-control" id="filterExportStatus" style="width: 150px;">
                                                        <option value="">All Status</option>
                                                        <option value="draft">Draft</option>
                                                        <option value="documentation">Documentation</option>
                                                        <option value="customs">Customs Clearance</option>
                                                        <option value="shipped">Shipped</option>
                                                        <option value="delivered">Delivered</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Order No.</th>
                                                            <th>Buyer</th>
                                                            <th>Commodity</th>
                                                            <th>Quantity</th>
                                                            <th>Value</th>
                                                            <th>Destination</th>
                                                            <th>Status</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="exportOrdersTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>

                                        <!-- Export Documents Tab -->
                                        <div class="tab-pane fade" id="export-docs-pane" role="tabpanel">
                                            <h5 class="mb-4">Export Documentation Hub</h5>
                                            <div class="row g-4">
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generateCommercialInvoice()">
                                                        <i class="icofont-file-text fs-48 mb-3"></i>
                                                        <h6>Commercial Invoice</h6>
                                                        <p class="mb-0">Generate export invoice</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generatePackingList()">
                                                        <i class="icofont-list fs-48 mb-3"></i>
                                                        <h6>Packing List</h6>
                                                        <p class="mb-0">Item-wise packing details</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generateBillOfLading()">
                                                        <i class="icofont-ship fs-48 mb-3"></i>
                                                        <h6>Bill of Lading</h6>
                                                        <p class="mb-0">Shipping document</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generateCertificateOfOrigin()">
                                                        <i class="icofont-certificate fs-48 mb-3"></i>
                                                        <h6>Certificate of Origin</h6>
                                                        <p class="mb-0">Origin verification</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generateFSSAICertificate()">
                                                        <i class="icofont-shield fs-48 mb-3"></i>
                                                        <h6>FSSAI Certificate</h6>
                                                        <p class="mb-0">Food safety compliance</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="bg-light padding30 rounded-1 text-center hover" onclick="generateShippingBill()">
                                                        <i class="icofont-file-alt fs-48 mb-3"></i>
                                                        <h6>Shipping Bill</h6>
                                                        <p class="mb-0">Customs declaration</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Compliance & Legal Tab -->
                                        <div class="tab-pane fade" id="compliance-pane" role="tabpanel">
                                            <h5 class="mb-4">AI-Powered Compliance & Legal Check</h5>
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Commodity Compliance Check</h6>
                                                        <div class="mb-3">
                                                            <label class="form-label">Select Commodity</label>
                                                            <select class="form-control" id="complianceCommodity">
                                                                <option value="">Select Commodity</option>
                                                                <option value="rice-husk">Rice Husk</option>
                                                                <option value="wheat-straw">Wheat Straw</option>
                                                                <option value="bagasse">Bagasse</option>
                                                                <option value="cotton-stalks">Cotton Stalks</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Destination Country</label>
                                                            <select class="form-control" id="complianceCountry">
                                                                <option value="">Select Country</option>
                                                                <option value="US">United States</option>
                                                                <option value="EU">European Union</option>
                                                                <option value="UK">United Kingdom</option>
                                                                <option value="AU">Australia</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn-main" onclick="runComplianceCheck()">Run AI Compliance Check</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Compliance Results</h6>
                                                        <div id="complianceResults">
                                                            <p class="text-muted">Select commodity and destination to run compliance check</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Duty Calculator Section -->
                                            <div class="row g-4 mt-4">
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Destination Country Duty Calculator</h6>
                                                        <div class="mb-3">
                                                            <label class="form-label">Commodity Type</label>
                                                            <select class="form-control" id="dutyCommodity">
                                                                <option value="">Select Commodity</option>
                                                                <option value="rice-husk">Rice Husk</option>
                                                                <option value="wheat-straw">Wheat Straw</option>
                                                                <option value="bagasse">Bagasse</option>
                                                                <option value="cotton-stalks">Cotton Stalks</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Destination Country</label>
                                                            <select class="form-control" id="dutyCountry">
                                                                <option value="">Select Country</option>
                                                                <option value="US">United States</option>
                                                                <option value="EU">European Union</option>
                                                                <option value="UK">United Kingdom</option>
                                                                <option value="AU">Australia</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Export Value (USD)</label>
                                                            <input type="number" class="form-control" id="dutyValue" placeholder="Enter export value">
                                                        </div>
                                                        <button class="btn-main" onclick="runDutyCalculation()">Calculate Import Duties</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Duty Calculation Results</h6>
                                                        <div id="dutyResults">
                                                            <p class="text-muted">Select commodity, destination, and value to calculate duties</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Documentation Requirements Section -->
                                            <div class="row g-4 mt-4">
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Documentation Requirements Check</h6>
                                                        <div class="mb-3">
                                                            <label class="form-label">Commodity Type</label>
                                                            <select class="form-control" id="docCommodity">
                                                                <option value="">Select Commodity</option>
                                                                <option value="rice-husk">Rice Husk</option>
                                                                <option value="wheat-straw">Wheat Straw</option>
                                                                <option value="bagasse">Bagasse</option>
                                                                <option value="cotton-stalks">Cotton Stalks</option>
                                                            </select>
                                                        </div>
                                                        <div class="mb-3">
                                                            <label class="form-label">Destination Country</label>
                                                            <select class="form-control" id="docCountry">
                                                                <option value="">Select Country</option>
                                                                <option value="US">United States</option>
                                                                <option value="EU">European Union</option>
                                                                <option value="UK">United Kingdom</option>
                                                                <option value="AU">Australia</option>
                                                            </select>
                                                        </div>
                                                        <button class="btn-main" onclick="runDocumentationCheck()">Check Documentation Requirements</button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="bg-light padding30 rounded-1">
                                                        <h6>Documentation Requirements</h6>
                                                        <div id="documentationResults">
                                                            <p class="text-muted">Select commodity and destination to check documentation requirements</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Export Analytics Tab -->
                                        <div class="tab-pane fade" id="export-analytics-pane" role="tabpanel">
                                            <h5 class="mb-4">Export Analytics Dashboard</h5>
                                            <div class="row g-4 mb-4">
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="totalExportValue">$0</h3>
                                                        <p class="mb-0">Total Export Value</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="totalExportOrders">0</h3>
                                                        <p class="mb-0">Total Orders</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="topDestination">-</h3>
                                                        <p class="mb-0">Top Destination</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="bg-color text-light padding30 rounded-1 text-center">
                                                        <h3 class="text-color" id="complianceRating">-</h3>
                                                        <p class="mb-0">Compliance Rating</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="table-responsive">
                                                <table class="table table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>Order No.</th>
                                                            <th>Destination</th>
                                                            <th>Commodity</th>
                                                            <th>Value</th>
                                                            <th>Status</th>
                                                            <th>Compliance Score</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="exportAnalyticsTable">
                                                        <!-- Dynamic content will be loaded here -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sourcing Overview -->
                            <div class="col-lg-8">
                                <h4 class="mb-4">Sourcing Overview</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <h6>Rice Husk</h6>
                                            <div class="d-flex justify-content-between">
                                                <span>This Month:</span>
                                                <span class="fw-bold">150 tons</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Avg. Price:</span>
                                                <span class="fw-bold">₹1,200/ton</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Wheat Straw</h6>
                                            <div class="d-flex justify-content-between">
                                                <span>This Month:</span>
                                                <span class="fw-bold">90 tons</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Avg. Price:</span>
                                                <span class="fw-bold">₹800/ton</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Cotton Waste</h6>
                                            <div class="d-flex justify-content-between">
                                                <span>This Month:</span>
                                                <span class="fw-bold">40 tons</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Avg. Price:</span>
                                                <span class="fw-bold">₹1,500/ton</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h6>Bagasse</h6>
                                            <div class="d-flex justify-content-between">
                                                <span>This Month:</span>
                                                <span class="fw-bold">180 tons</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Avg. Price:</span>
                                                <span class="fw-bold">₹900/ton</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Purchases -->
                            <div class="col-lg-4">
                                <h4 class="mb-4">Recent Purchases</h4>
                                <div class="bg-light padding30 rounded-1">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Rice Husk - 50 tons</h6>
                                            <p class="text-muted mb-0">From Rajesh Kumar</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-success">₹60,000</span>
                                            <br><small class="text-muted">2 days ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-1">Wheat Straw - 30 tons</h6>
                                            <p class="text-muted mb-0">From Priya Sharma</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-success">₹24,000</span>
                                            <br><small class="text-muted">1 day ago</small>
                                        </div>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="mb-1">Cotton Waste - 20 tons</h6>
                                            <p class="text-muted mb-0">From Amit Patel</p>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-success">₹30,000</span>
                                            <br><small class="text-muted">3 days ago</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- content end -->

        <!-- footer begin -->
        <footer class="section-dark">
            <div class="container relative z-2">
                <div class="row gx-5">
                    <div class="col-lg-4 col-sm-6">
                        <img src="images/white.png" class="w-150px" alt="">
                        <div class="spacer-20"></div>
                        <p>Transform agricultural waste into valuable resources with Bhoomi's comprehensive marketplace platform! Connect farmers, warehouses, and manufacturers through our innovative ecosystem.</p>
                        <div class="social-icons mb-sm-30">
                            <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                            <a href="#"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="#"><i class="fa-brands fa-instagram"></i></a>
                            <a href="#"><i class="fa-brands fa-youtube"></i></a>
                            <a href="#"><i class="fa-brands fa-whatsapp"></i></a>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-12 order-lg-1 order-sm-2">
                        <div class="row">
                            <div class="col-lg-6 col-sm-6">
                                <div class="widget">
                                    <h5>Company</h5>
                                    <ul>
                                        <li><a href="index.html">Home</a></li>
                                        <li><a href="services.html">Our Services</a></li>
                                        <li><a href="projects.html">Projects</a></li>
                                        <li><a href="about.html">About Us</a></li>
                                        <li><a href="contact.html">Contact</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-lg-6 col-sm-6">
                                <div class="widget">
                                    <h5>Our Services</h5>
                                    <ul>
                                        <li><a href="service-single.html">Farmer Byproduct Marketplace</a></li>
                                        <li><a href="service-single.html">Warehouse Partnership Network</a></li>
                                        <li><a href="service-single.html">Manufacturer Sourcing Portal</a></li>
                                        <li><a href="service-single.html">Inventory Management System</a></li>
                                        <li><a href="service-single.html">Legal Compliance Automation</a></li>
                                        <li><a href="service-single.html">End-to-End Logistics Coordination</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-sm-6 order-lg-2 order-sm-1">
                        <div class="widget">
                            <div class="fw-bold text-white"><i class="icofont-clock-time me-2 id-color-2"></i>We're Open</div>
                            Monday - Friday (08.00 AM - 10.00 PM)
                            <div class="spacer-20"></div>
                            <div class="fw-bold text-white"><i class="icofont-location-pin me-2 id-color-2"></i>Office Location</div>
                            India
                            <div class="spacer-20"></div>
                            <div class="fw-bold text-white"><i class="icofont-envelope me-2 id-color-2"></i>Send a Message</div>
                            bhoomi@yahoo.com
                        </div>
                    </div>
                </div>
            </div>
            <div class="subfooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="de-flex">
                                <div class="de-flex-col">
                                    Copyright 2024 - Bhoomi Agricultural Marketplace
                                </div>
                                <ul class="menu-simple">
                                    <li><a href="#">Terms &amp; Conditions</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <img src="images/misc/silhuette-1-black.webp" class="abs bottom-0 op-3" alt="">
        </footer>
        <!-- footer end -->
    </div>

    <!-- Javascript Files -->
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>
    
    <script>
        // Check authentication and show appropriate dashboard
        document.addEventListener('DOMContentLoaded', function() {
            const userSession = JSON.parse(localStorage.getItem('bhoomiUserSession') || 'null');
            
            if (!userSession || !userSession.isLoggedIn) {
                // User not logged in, redirect to login
                window.location.href = 'login.html';
                return;
            }
            
            // Show appropriate dashboard based on user type
            const userType = userSession.userType;
            const dashboardTitle = document.getElementById('dashboard-title');
            const dashboardSubtitle = document.getElementById('dashboard-subtitle');
            
            // Hide all dashboards first
            document.querySelectorAll('.dashboard-content').forEach(dashboard => {
                dashboard.style.display = 'none';
            });
            
            // Show appropriate dashboard
            const dashboardElement = document.getElementById(userType + '-dashboard');
            if (dashboardElement) {
                dashboardElement.style.display = 'block';
                
                // Update title and subtitle
                switch(userType) {
                    case 'farmer':
                        dashboardTitle.textContent = 'Farmer Dashboard';
                        dashboardSubtitle.textContent = 'Manage your agricultural byproduct listings and track your earnings!';
                        break;
                    case 'warehouse':
                        dashboardTitle.textContent = 'Warehouse Partner Dashboard';
                        dashboardSubtitle.textContent = 'Manage your storage partnerships and track rental income!';
                        break;
                    case 'manufacturer':
                        dashboardTitle.textContent = 'Manufacturer Dashboard';
                        dashboardSubtitle.textContent = 'Source agricultural byproducts and manage your suppliers!';
                        break;
                }
            }
        });

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('bhoomiUserSession');
                window.location.href = 'login.html';
            }
        }

        // ====== COMPREHENSIVE INVOICE GENERATION SYSTEM ======

        // Automated Invoice Generation when warehouse accepts stock request
        function generateComprehensiveInvoice(stockRequest, warehouseData, farmerData, ratePerUnit) {
            try {
                const invoiceNumber = 'BHOOMI-' + (++invoiceCounter).toString().padStart(6, '0');
                const currentDate = new Date();
                const dueDate = new Date(currentDate.getTime() + (30 * 24 * 60 * 60 * 1000)); // 30 days from now
                
                // Get commodity details
                const commodity = stockRequest.byproductType;
                const quantity = parseFloat(stockRequest.quantity.split(' ')[0]);
                const quantityUnit = stockRequest.quantity.split(' ')[1] || 'MT';
                const rate = parseFloat(ratePerUnit);
                
                // Calculate gross amount
                const grossAmount = quantity * rate;
                
                // Get GST rate based on commodity type
                const gstRate = GST_RATES[commodity] || GST_RATES['other'];
                
                // Check if farmer is GST exempt
                const farmerTurnover = getFarmerAnnualTurnover(stockRequest.farmerId);
                const isGSTExempt = farmerTurnover < GST_EXEMPTION_LIMIT;
                
                // Calculate GST
                const gstAmount = isGSTExempt ? 0 : (grossAmount * gstRate) / 100;
                const taxableAmount = grossAmount;
                const totalWithGST = grossAmount + gstAmount;
                
                // Calculate Platform Commission
                const commissionPercentage = getCommissionRate(stockRequest.farmerId);
                const commissionAmount = (grossAmount * commissionPercentage) / 100;
                const commissionGST = (commissionAmount * COMMISSION_GST_RATE) / 100;
                const totalCommission = commissionAmount + commissionGST;
                
                // Calculate TDS if applicable
                const tdsAmount = grossAmount >= TDS_THRESHOLD ? (grossAmount * TDS_RATE) : 0;
                
                // Calculate net payable amount to farmer
                const netPayableToFarmer = grossAmount + gstAmount - tdsAmount - totalCommission;
                
                // Generate comprehensive invoice object
                const invoice = {
                    id: generateUniqueId(),
                    invoiceNumber: invoiceNumber,
                    date: currentDate.toISOString().split('T')[0],
                    dueDate: dueDate.toISOString().split('T')[0],
                    timestamp: currentDate.toISOString(),
                    
                    // Farmer Details
                    farmer: {
                        id: stockRequest.farmerId,
                        name: farmerData.fullName || stockRequest.farmerName,
                        address: farmerData.address || 'Address not available',
                        mobile: farmerData.mobile || 'Mobile not available',
                        aadhaar: farmerData.aadhaar || 'Aadhaar not available',
                        panCard: farmerData.panCard || 'PAN not available',
                        bankAccount: {
                            accountNumber: farmerData.bankAccount || 'Account not available',
                            ifscCode: farmerData.ifscCode || 'IFSC not available',
                            bankName: farmerData.bankName || 'Bank not available'
                        },
                        gstNumber: farmerData.gstNumber || null,
                        isGSTExempt: isGSTExempt,
                        annualTurnover: farmerTurnover
                    },
                    
                    // Warehouse Details
                    warehouse: {
                        id: warehouseData.id,
                        companyName: warehouseData.companyName || 'Warehouse Company',
                        gstin: warehouseData.gstin || 'GSTIN not available',
                        address: warehouseData.address || 'Address not available',
                        contact: warehouseData.contact || 'Contact not available',
                        email: warehouseData.email || 'Email not available'
                    },
                    
                    // Commodity Information
                    commodity: {
                        cropType: stockRequest.cropType,
                        byproductType: commodity,
                        description: getByproductDescription(commodity),
                        hsCode: getHSCode(commodity),
                        quantity: quantity,
                        quantityUnit: quantityUnit,
                        ratePerUnit: rate,
                        qualityGrade: stockRequest.qualityGrade
                    },
                    
                    // Tax Calculations
                    calculations: {
                        grossAmount: grossAmount,
                        taxableAmount: taxableAmount,
                        gstRate: gstRate,
                        gstAmount: gstAmount,
                        totalWithGST: totalWithGST,
                        commissionPercentage: commissionPercentage,
                        commissionAmount: commissionAmount,
                        commissionGST: commissionGST,
                        totalCommission: totalCommission,
                        tdsRate: grossAmount >= TDS_THRESHOLD ? TDS_RATE * 100 : 0,
                        tdsAmount: tdsAmount,
                        netPayableToFarmer: netPayableToFarmer,
                        roundedNetAmount: Math.round(netPayableToFarmer)
                    },
                    
                    // Payment Details
                    payment: {
                        status: 'pending',
                        method: null,
                        transactionId: null,
                        paidDate: null,
                        approvedBy: null,
                        approvedDate: null,
                        paymentTerms: '30 days from invoice date',
                        bankCharges: 0
                    },
                    
                    // Compliance
                    compliance: {
                        isGSTCompliant: true,
                        isTDSCompliant: true,
                        complianceScore: 100,
                        auditTrail: [
                            {
                                action: 'invoice_generated',
                                timestamp: currentDate.toISOString(),
                                userId: getCurrentUserId(),
                                details: 'Invoice automatically generated upon stock request acceptance'
                            }
                        ]
                    },
                    
                    // Status and Workflow
                    status: 'pending_approval',
                    workflow: {
                        step: 1,
                        totalSteps: 3,
                        steps: [
                            { name: 'Invoice Generated', status: 'completed', date: currentDate.toISOString() },
                            { name: 'Pending Approval', status: 'pending', date: null },
                            { name: 'Payment Processing', status: 'pending', date: null }
                        ]
                    }
                };
                
                // Store invoice
                invoices.push(invoice);
                localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
                localStorage.setItem('bhoomiInvoiceCounter', invoiceCounter.toString());
                
                // Update stock request with invoice reference
                const requestIndex = stockRequests.findIndex(r => r.id === stockRequest.id);
                if (requestIndex !== -1) {
                    stockRequests[requestIndex].invoiceId = invoice.id;
                    stockRequests[requestIndex].invoiceNumber = invoice.invoiceNumber;
                    localStorage.setItem('bhoomiStockRequests', JSON.stringify(stockRequests));
                }
                
                return invoice;
                
            } catch (error) {
                console.error('Error generating comprehensive invoice:', error);
                throw error;
            }
        }

        // Get farmer annual turnover for GST exemption check
        function getFarmerAnnualTurnover(farmerId) {
            const farmerProfile = farmerProfiles.find(f => f.id === farmerId);
            return farmerProfile ? (farmerProfile.annualTurnover || 0) : 0;
        }

        // Get commission rate based on farmer tier
        function getCommissionRate(farmerId) {
            const farmerProfile = farmerProfiles.find(f => f.id === farmerId);
            const tier = farmerProfile ? (farmerProfile.tier || 'basic') : 'basic';
            return COMMISSION_RATES[tier] || COMMISSION_RATES['basic'];
        }

        // Get byproduct description
        function getByproductDescription(byproductType) {
            const descriptions = {
                'rice-husk': 'Rice Husk - Agricultural waste from rice processing',
                'wheat-straw': 'Wheat Straw - Post-harvest wheat residue',
                'sugarcane-bagasse': 'Sugarcane Bagasse - Fibrous residue after juice extraction',
                'corn-stalks': 'Corn Stalks - Dried corn plant stems',
                'cotton-stalks': 'Cotton Stalks - Post-harvest cotton plant stems',
                'coconut-coir': 'Coconut Coir - Fiber from coconut husk',
                'mustard-husk': 'Mustard Husk - Waste from mustard oil extraction',
                'soybean-meal': 'Soybean Meal - Protein-rich residue from oil extraction'
            };
            return descriptions[byproductType] || 'Agricultural byproduct';
        }

        // Get HS Code for commodity
        function getHSCode(byproductType) {
            const hsCodes = {
                'rice-husk': '23021000',
                'wheat-straw': '12129900',
                'sugarcane-bagasse': '23032000',
                'corn-stalks': '12129900',
                'cotton-stalks': '14049000',
                'coconut-coir': '53050000',
                'mustard-husk': '23064900',
                'soybean-meal': '23040000'
            };
            return hsCodes[byproductType] || '12129900';
        }

        // ====== INVOICE DISPLAY AND MANAGEMENT FUNCTIONS ======

        // Load and display farmer invoices
        function loadMyInvoices() {
            try {
                const currentUserId = getCurrentUserId();
                const userInvoices = invoices.filter(invoice => invoice.farmer.id === currentUserId);
                
                const tableBody = document.getElementById('myInvoicesTable');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (userInvoices.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="13" class="text-center">No invoices found</td></tr>';
                    updateInvoiceSummary([], 'farmer');
                    return;
                }
                
                userInvoices.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${invoice.invoiceNumber}</strong></td>
                        <td>${formatDate(invoice.date)}</td>
                        <td>${invoice.warehouse.companyName}</td>
                        <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                        <td>${invoice.commodity.quantity} ${invoice.commodity.quantityUnit}</td>
                        <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                        <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.gstAmount.toFixed(2)} (${invoice.calculations.gstRate}%)</td>
                        <td>₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.totalCommission.toFixed(2)}</td>
                        <td><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                        <td><span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewInvoiceDetails('${invoice.id}')" title="View Details">
                                    <i class="icofont-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="downloadInvoicePDF('${invoice.id}')" title="Download PDF">
                                    <i class="icofont-download"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="printInvoice('${invoice.id}')" title="Print">
                                    <i class="icofont-printer"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                updateInvoiceSummary(userInvoices, 'farmer');
                
            } catch (error) {
                console.error('Error loading my invoices:', error);
            }
        }

        // Load and display generated invoices for warehouse
        function loadGeneratedInvoices() {
            try {
                const currentUserId = getCurrentUserId();
                const warehouseInvoices = invoices.filter(invoice => invoice.warehouse.id === currentUserId);
                
                const tableBody = document.getElementById('generatedInvoicesTable');
                if (!tableBody) return;
                
                tableBody.innerHTML = '';
                
                if (warehouseInvoices.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="13" class="text-center">No invoices generated yet</td></tr>';
                    updateInvoiceSummary([], 'warehouse');
                    return;
                }
                
                warehouseInvoices.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="invoice-checkbox" value="${invoice.id}">
                            <strong>${invoice.invoiceNumber}</strong>
                        </td>
                        <td>${formatDate(invoice.date)}</td>
                        <td>${invoice.farmer.name}</td>
                        <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                        <td>${invoice.commodity.quantity} ${invoice.commodity.quantityUnit}</td>
                        <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                        <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.gstAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.totalCommission.toFixed(2)}</td>
                        <td><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                        <td><span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewInvoiceDetails('${invoice.id}')" title="View Details">
                                    <i class="icofont-eye"></i>
                                </button>
                                ${invoice.status === 'pending_approval' ? `
                                    <button class="btn btn-outline-success" onclick="approveInvoice('${invoice.id}')" title="Approve">
                                        <i class="icofont-check"></i>
                                    </button>
                                ` : ''}
                                <button class="btn btn-outline-info" onclick="updatePaymentStatus('${invoice.id}')" title="Update Payment">
                                    <i class="icofont-money"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="downloadInvoicePDF('${invoice.id}')" title="Download">
                                    <i class="icofont-download"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                updateInvoiceSummary(warehouseInvoices, 'warehouse');
                
            } catch (error) {
                console.error('Error loading generated invoices:', error);
            }
        }

        // Update invoice summary cards
        function updateInvoiceSummary(invoiceList, type) {
            if (type === 'farmer') {
                document.getElementById('totalInvoicesCount').textContent = invoiceList.length;
                
                const totalAmount = invoiceList.reduce((sum, inv) => sum + inv.calculations.grossAmount, 0);
                document.getElementById('totalInvoiceAmount').textContent = `₹${totalAmount.toFixed(2)}`;
                
                const amountReceived = invoiceList.filter(inv => inv.payment.status === 'paid')
                    .reduce((sum, inv) => sum + inv.calculations.roundedNetAmount, 0);
                document.getElementById('amountReceived').textContent = `₹${amountReceived.toFixed(2)}`;
                
                const pendingAmount = totalAmount - amountReceived;
                document.getElementById('pendingAmount').textContent = `₹${pendingAmount.toFixed(2)}`;
                
            } else if (type === 'warehouse') {
                document.getElementById('totalGeneratedInvoices').textContent = invoiceList.length;
                
                const totalAmount = invoiceList.reduce((sum, inv) => sum + inv.calculations.grossAmount, 0);
                document.getElementById('totalGeneratedAmount').textContent = `₹${totalAmount.toFixed(2)}`;
                
                const commissionEarned = invoiceList.reduce((sum, inv) => sum + inv.calculations.totalCommission, 0);
                document.getElementById('totalCommissionEarned').textContent = `₹${commissionEarned.toFixed(2)}`;
                
                const tdsCollected = invoiceList.reduce((sum, inv) => sum + inv.calculations.tdsAmount, 0);
                document.getElementById('totalTDSCollected').textContent = `₹${tdsCollected.toFixed(2)}`;
                
                const gstCollected = invoiceList.reduce((sum, inv) => sum + inv.calculations.gstAmount, 0);
                document.getElementById('totalGSTCollected').textContent = `₹${gstCollected.toFixed(2)}`;
                
                const netPayable = invoiceList.reduce((sum, inv) => sum + inv.calculations.roundedNetAmount, 0);
                document.getElementById('totalNetPayable').textContent = `₹${netPayable.toFixed(2)}`;
            }
        }

        // Get payment status badge class
        function getPaymentStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'bg-warning';
                case 'approved': return 'bg-info';
                case 'paid': return 'bg-success';
                case 'overdue': return 'bg-danger';
                case 'cancelled': return 'bg-secondary';
                default: return 'bg-secondary';
            }
        }

        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }

        // ====== INVOICE WORKFLOW AND PDF GENERATION FUNCTIONS ======

        // View detailed invoice information
        function viewInvoiceDetails(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            hideAllSections();
            const modalSection = document.getElementById('invoice-details-modal');
            const contentDiv = document.getElementById('invoice-details-content');
            
            contentDiv.innerHTML = generateInvoiceHTML(invoice);
            modalSection.style.display = 'block';
            
            // Store current invoice ID for actions
            window.currentInvoiceId = invoiceId;
        }

        // Hide invoice details modal
        function hideInvoiceDetails() {
            document.getElementById('invoice-details-modal').style.display = 'none';
            window.currentInvoiceId = null;
        }

        // Generate comprehensive invoice HTML
        function generateInvoiceHTML(invoice) {
            return `
                <div class="invoice-container bg-white p-4 rounded border" style="max-width: 800px; margin: 0 auto;">
                    <!-- Invoice Header -->
                    <div class="row mb-4">
                        <div class="col-6">
                            <img src="images/logo-black.png" alt="Bhoomi Logo" style="height: 50px;">
                            <h2 class="text-success mt-2">BHOOMI</h2>
                            <p class="text-muted">Agricultural Marketplace Platform</p>
                        </div>
                        <div class="col-6 text-end">
                            <h3 class="text-primary mb-3">TAX INVOICE</h3>
                            <div class="invoice-meta">
                                <p><strong>Invoice No:</strong> ${invoice.invoiceNumber}</p>
                                <p><strong>Date:</strong> ${formatDate(invoice.date)}</p>
                                <p><strong>Due Date:</strong> ${formatDate(invoice.dueDate)}</p>
                                <p><strong>Status:</strong> <span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Billing Details -->
                    <div class="row mb-4">
                        <div class="col-6">
                            <h5 class="text-success mb-3">Bill From (Farmer)</h5>
                            <div class="billing-info">
                                <p><strong>${invoice.farmer.name}</strong></p>
                                <p>${invoice.farmer.address}</p>
                                <p>Mobile: ${invoice.farmer.mobile}</p>
                                <p>Aadhaar: ${invoice.farmer.aadhaar}</p>
                                <p>PAN: ${invoice.farmer.panCard}</p>
                                ${invoice.farmer.gstNumber ? `<p>GSTIN: ${invoice.farmer.gstNumber}</p>` : '<p class="text-muted">GST Exempt (Turnover < ₹40L)</p>'}
                            </div>
                        </div>
                        <div class="col-6">
                            <h5 class="text-primary mb-3">Bill To (Warehouse)</h5>
                            <div class="billing-info">
                                <p><strong>${invoice.warehouse.companyName}</strong></p>
                                <p>${invoice.warehouse.address}</p>
                                <p>Contact: ${invoice.warehouse.contact}</p>
                                <p>Email: ${invoice.warehouse.email}</p>
                                <p>GSTIN: ${invoice.warehouse.gstin}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Commodity Details -->
                    <div class="mb-4">
                        <h5 class="text-info mb-3">Commodity Information</h5>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Description</th>
                                        <th>HS Code</th>
                                        <th>Quality</th>
                                        <th>Quantity</th>
                                        <th>Unit</th>
                                        <th>Rate per ${invoice.commodity.quantityUnit}</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <strong>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</strong><br>
                                            <small class="text-muted">${invoice.commodity.description}</small>
                                        </td>
                                        <td>${invoice.commodity.hsCode}</td>
                                        <td>${capitalizeFirst(invoice.commodity.qualityGrade)}</td>
                                        <td>${invoice.commodity.quantity}</td>
                                        <td>${invoice.commodity.quantityUnit}</td>
                                        <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                                        <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tax Calculations -->
                    <div class="row mb-4">
                        <div class="col-8"></div>
                        <div class="col-4">
                            <div class="calculation-summary">
                                <table class="table table-sm">
                                    <tr>
                                        <td><strong>Taxable Amount:</strong></td>
                                        <td class="text-end">₹${invoice.calculations.taxableAmount.toFixed(2)}</td>
                                    </tr>
                                    <tr>
                                        <td>GST @ ${invoice.calculations.gstRate}%:</td>
                                        <td class="text-end">₹${invoice.calculations.gstAmount.toFixed(2)}</td>
                                    </tr>
                                    <tr class="table-light">
                                        <td><strong>Total with GST:</strong></td>
                                        <td class="text-end"><strong>₹${invoice.calculations.totalWithGST.toFixed(2)}</strong></td>
                                    </tr>
                                    <tr class="table-warning">
                                        <td>Platform Commission (${invoice.calculations.commissionPercentage}%):</td>
                                        <td class="text-end">₹${invoice.calculations.commissionAmount.toFixed(2)}</td>
                                    </tr>
                                    <tr>
                                        <td>Commission GST (18%):</td>
                                        <td class="text-end">₹${invoice.calculations.commissionGST.toFixed(2)}</td>
                                    </tr>
                                    ${invoice.calculations.tdsAmount > 0 ? `
                                        <tr class="table-info">
                                            <td>TDS Deducted @ ${invoice.calculations.tdsRate}%:</td>
                                            <td class="text-end">₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                                        </tr>
                                    ` : ''}
                                    <tr class="table-success">
                                        <td><strong>Net Payable to Farmer:</strong></td>
                                        <td class="text-end"><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Details -->
                    <div class="mb-4">
                        <h5 class="text-warning mb-3">Payment Information</h5>
                        <div class="row">
                            <div class="col-6">
                                <p><strong>Bank Details:</strong></p>
                                <p>Account: ${invoice.farmer.bankAccount.accountNumber}</p>
                                <p>IFSC: ${invoice.farmer.bankAccount.ifscCode}</p>
                                <p>Bank: ${invoice.farmer.bankAccount.bankName}</p>
                            </div>
                            <div class="col-6">
                                <p><strong>Payment Terms:</strong> ${invoice.payment.paymentTerms}</p>
                                <p><strong>Status:</strong> <span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></p>
                                ${invoice.payment.transactionId ? `<p><strong>Transaction ID:</strong> ${invoice.payment.transactionId}</p>` : ''}
                                ${invoice.payment.paidDate ? `<p><strong>Paid Date:</strong> ${formatDate(invoice.payment.paidDate)}</p>` : ''}
                            </div>
                        </div>
                    </div>

                    <!-- Workflow Status -->
                    <div class="mb-4">
                        <h5 class="text-secondary mb-3">Invoice Workflow</h5>
                        <div class="progress mb-2" style="height: 25px;">
                            <div class="progress-bar ${invoice.workflow.step >= 1 ? 'bg-success' : 'bg-light'}" style="width: 33.33%;">Generated</div>
                            <div class="progress-bar ${invoice.workflow.step >= 2 ? 'bg-info' : 'bg-light'}" style="width: 33.33%;">Approved</div>
                            <div class="progress-bar ${invoice.workflow.step >= 3 ? 'bg-success' : 'bg-light'}" style="width: 33.33%;">Paid</div>
                        </div>
                        <small class="text-muted">Step ${invoice.workflow.step} of ${invoice.workflow.totalSteps}</small>
                    </div>

                    <!-- Compliance and Audit Trail -->
                    <div class="mb-4">
                        <h6 class="text-info">Compliance Information</h6>
                        <div class="row">
                            <div class="col-6">
                                <p><small>GST Compliant: <span class="text-success">✓ Yes</span></small></p>
                                <p><small>TDS Compliant: <span class="text-success">✓ Yes</span></small></p>
                            </div>
                            <div class="col-6">
                                <p><small>Compliance Score: <span class="badge bg-success">${invoice.compliance.complianceScore}%</span></small></p>
                                <p><small>Generated: ${formatDate(invoice.timestamp)}</small></p>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="text-center mt-4 pt-3 border-top">
                        <p class="text-muted small">
                            This is a computer generated invoice and does not require physical signature.<br>
                            For queries, contact: support@bhoomi.com | +91-1234567890
                        </p>
                    </div>
                </div>
            `;
        }

        // Approve invoice (warehouse function)
        function approveInvoice(invoiceId) {
            if (!confirm('Are you sure you want to approve this invoice for payment?')) return;
            
            const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
            if (invoiceIndex === -1) {
                alert('Invoice not found');
                return;
            }
            
            const invoice = invoices[invoiceIndex];
            invoice.status = 'approved';
            invoice.payment.status = 'approved';
            invoice.payment.approvedBy = getCurrentUserId();
            invoice.payment.approvedDate = new Date().toISOString();
            invoice.workflow.step = 2;
            invoice.workflow.steps[1].status = 'completed';
            invoice.workflow.steps[1].date = new Date().toISOString();
            
            // Add audit trail
            invoice.compliance.auditTrail.push({
                action: 'invoice_approved',
                timestamp: new Date().toISOString(),
                userId: getCurrentUserId(),
                details: 'Invoice approved for payment processing'
            });
            
            // Save changes
            localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
            
            alert('Invoice approved successfully!');
            loadGeneratedInvoices();
        }

        // Update payment status
        function updatePaymentStatus(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            const newStatus = prompt(`Current status: ${invoice.payment.status}\n\nEnter new payment status:\n1. pending\n2. approved\n3. paid\n4. overdue\n5. cancelled`, invoice.payment.status);
            
            if (!newStatus || newStatus === invoice.payment.status) return;
            
            const validStatuses = ['pending', 'approved', 'paid', 'overdue', 'cancelled'];
            if (!validStatuses.includes(newStatus)) {
                alert('Invalid status. Please enter: pending, approved, paid, overdue, or cancelled');
                return;
            }
            
            const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
            invoices[invoiceIndex].payment.status = newStatus;
            
            if (newStatus === 'paid') {
                const transactionId = prompt('Enter transaction ID (optional):') || '';
                invoices[invoiceIndex].payment.transactionId = transactionId;
                invoices[invoiceIndex].payment.paidDate = new Date().toISOString();
                invoices[invoiceIndex].workflow.step = 3;
                invoices[invoiceIndex].workflow.steps[2].status = 'completed';
                invoices[invoiceIndex].workflow.steps[2].date = new Date().toISOString();
                
                // Add audit trail
                invoices[invoiceIndex].compliance.auditTrail.push({
                    action: 'payment_completed',
                    timestamp: new Date().toISOString(),
                    userId: getCurrentUserId(),
                    details: `Payment marked as completed. Transaction ID: ${transactionId}`
                });
            }
            
            // Save changes
            localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
            
            alert(`Payment status updated to: ${newStatus}`);
            loadGeneratedInvoices();
            if (typeof loadMyInvoices === 'function') loadMyInvoices();
        }

        // ====== PDF GENERATION AND PRINT FUNCTIONS ======

        // Download invoice as PDF
        function downloadInvoicePDF(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            // Create a new window with invoice content for PDF generation
            const printWindow = window.open('', '_blank');
            const invoiceHTML = generatePrintableInvoiceHTML(invoice);
            
            printWindow.document.write(invoiceHTML);
            printWindow.document.close();
            
            // Trigger print dialog which can save as PDF
            setTimeout(() => {
                printWindow.print();
            }, 500);
        }

        // Print invoice
        function printInvoice(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) {
                alert('Invoice not found');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            const invoiceHTML = generatePrintableInvoiceHTML(invoice);
            
            printWindow.document.write(invoiceHTML);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }

        // Generate printable invoice HTML with proper styling
        function generatePrintableInvoiceHTML(invoice) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${invoice.invoiceNumber} - Bhoomi</title>
                    <meta charset="utf-8">
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            margin: 0;
                            padding: 20px;
                            color: #333;
                            line-height: 1.4;
                        }
                        .invoice-container {
                            max-width: 800px;
                            margin: 0 auto;
                            background: white;
                        }
                        .header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 3px solid #28a745;
                        }
                        .logo-section h1 {
                            color: #28a745;
                            margin: 0;
                            font-size: 28px;
                        }
                        .logo-section p {
                            margin: 5px 0 0 0;
                            color: #666;
                        }
                        .invoice-title {
                            text-align: right;
                        }
                        .invoice-title h2 {
                            color: #007bff;
                            margin: 0;
                            font-size: 24px;
                        }
                        .billing-section {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 30px;
                        }
                        .billing-info {
                            width: 48%;
                        }
                        .billing-info h3 {
                            color: #28a745;
                            margin-bottom: 15px;
                            font-size: 16px;
                            border-bottom: 1px solid #ddd;
                            padding-bottom: 5px;
                        }
                        .billing-info p {
                            margin: 5px 0;
                            font-size: 14px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td {
                            border: 1px solid #ddd;
                            padding: 10px;
                            text-align: left;
                            font-size: 14px;
                        }
                        th {
                            background-color: #f8f9fa;
                            font-weight: bold;
                        }
                        .calculation-table {
                            width: 50%;
                            margin-left: auto;
                            margin-bottom: 30px;
                        }
                        .calculation-table td:last-child {
                            text-align: right;
                        }
                        .total-row {
                            background-color: #e8f5e8;
                            font-weight: bold;
                        }
                        .payment-info {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 30px;
                        }
                        .payment-info div {
                            width: 48%;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #ddd;
                            font-size: 12px;
                            color: #666;
                        }
                        .badge {
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 12px;
                            font-weight: bold;
                        }
                        .badge-success { background-color: #d4edda; color: #155724; }
                        .badge-warning { background-color: #fff3cd; color: #856404; }
                        .badge-info { background-color: #d1ecf1; color: #0c5460; }
                        .badge-danger { background-color: #f8d7da; color: #721c24; }
                        @media print {
                            body { margin: 0; }
                            .invoice-container { margin: 0; box-shadow: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice-container">
                        <!-- Header -->
                        <div class="header">
                            <div class="logo-section">
                                <h1>BHOOMI</h1>
                                <p>Agricultural Marketplace Platform</p>
                            </div>
                            <div class="invoice-title">
                                <h2>TAX INVOICE</h2>
                                <p><strong>Invoice No:</strong> ${invoice.invoiceNumber}</p>
                                <p><strong>Date:</strong> ${formatDate(invoice.date)}</p>
                                <p><strong>Due Date:</strong> ${formatDate(invoice.dueDate)}</p>
                            </div>
                        </div>

                        <!-- Billing Information -->
                        <div class="billing-section">
                            <div class="billing-info">
                                <h3>Bill From (Farmer)</h3>
                                <p><strong>${invoice.farmer.name}</strong></p>
                                <p>${invoice.farmer.address}</p>
                                <p>Mobile: ${invoice.farmer.mobile}</p>
                                <p>Aadhaar: ${invoice.farmer.aadhaar}</p>
                                <p>PAN: ${invoice.farmer.panCard}</p>
                                ${invoice.farmer.gstNumber ? `<p>GSTIN: ${invoice.farmer.gstNumber}</p>` : '<p style="color: #666;">GST Exempt (Turnover < ₹40L)</p>'}
                            </div>
                            <div class="billing-info">
                                <h3>Bill To (Warehouse)</h3>
                                <p><strong>${invoice.warehouse.companyName}</strong></p>
                                <p>${invoice.warehouse.address}</p>
                                <p>Contact: ${invoice.warehouse.contact}</p>
                                <p>Email: ${invoice.warehouse.email}</p>
                                <p>GSTIN: ${invoice.warehouse.gstin}</p>
                            </div>
                        </div>

                        <!-- Commodity Details -->
                        <table>
                            <thead>
                                <tr>
                                    <th>Description</th>
                                    <th>HS Code</th>
                                    <th>Quality</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Rate per ${invoice.commodity.quantityUnit}</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <strong>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</strong><br>
                                        <small>${invoice.commodity.description}</small>
                                    </td>
                                    <td>${invoice.commodity.hsCode}</td>
                                    <td>${capitalizeFirst(invoice.commodity.qualityGrade)}</td>
                                    <td>${invoice.commodity.quantity}</td>
                                    <td>${invoice.commodity.quantityUnit}</td>
                                    <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                                    <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                                </tr>
                            </tbody>
                        </table>

                        <!-- Tax Calculations -->
                        <table class="calculation-table">
                            <tr>
                                <td><strong>Taxable Amount:</strong></td>
                                <td>₹${invoice.calculations.taxableAmount.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>GST @ ${invoice.calculations.gstRate}%:</td>
                                <td>₹${invoice.calculations.gstAmount.toFixed(2)}</td>
                            </tr>
                            <tr style="background-color: #f8f9fa;">
                                <td><strong>Total with GST:</strong></td>
                                <td><strong>₹${invoice.calculations.totalWithGST.toFixed(2)}</strong></td>
                            </tr>
                            <tr style="background-color: #fff3cd;">
                                <td>Platform Commission (${invoice.calculations.commissionPercentage}%):</td>
                                <td>₹${invoice.calculations.commissionAmount.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>Commission GST (18%):</td>
                                <td>₹${invoice.calculations.commissionGST.toFixed(2)}</td>
                            </tr>
                            ${invoice.calculations.tdsAmount > 0 ? `
                                <tr style="background-color: #d1ecf1;">
                                    <td>TDS Deducted @ ${invoice.calculations.tdsRate}%:</td>
                                    <td>₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                                </tr>
                            ` : ''}
                            <tr class="total-row">
                                <td><strong>Net Payable to Farmer:</strong></td>
                                <td><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                            </tr>
                        </table>

                        <!-- Payment Information -->
                        <div class="payment-info">
                            <div>
                                <h3>Bank Details</h3>
                                <p>Account: ${invoice.farmer.bankAccount.accountNumber}</p>
                                <p>IFSC: ${invoice.farmer.bankAccount.ifscCode}</p>
                                <p>Bank: ${invoice.farmer.bankAccount.bankName}</p>
                            </div>
                            <div>
                                <h3>Payment Information</h3>
                                <p>Terms: ${invoice.payment.paymentTerms}</p>
                                <p>Status: ${capitalizeFirst(invoice.payment.status)}</p>
                                ${invoice.payment.transactionId ? `<p>Transaction ID: ${invoice.payment.transactionId}</p>` : ''}
                                ${invoice.payment.paidDate ? `<p>Paid Date: ${formatDate(invoice.payment.paidDate)}</p>` : ''}
                            </div>
                        </div>

                        <!-- Footer -->
                        <div class="footer">
                            <p><strong>Compliance Information:</strong></p>
                            <p>GST Compliant: ✓ Yes | TDS Compliant: ✓ Yes | Compliance Score: ${invoice.compliance.complianceScore}%</p>
                            <p style="margin-top: 15px;">
                                This is a computer generated invoice and does not require physical signature.<br>
                                For queries, contact: support@bhoomi.com | +91-1234567890
                            </p>
                        </div>
                    </div>
                </body>
                </html>
            `;
        }

        // Current invoice actions
        function downloadCurrentInvoice() {
            if (window.currentInvoiceId) {
                downloadInvoicePDF(window.currentInvoiceId);
            }
        }

        function printCurrentInvoice() {
            if (window.currentInvoiceId) {
                printInvoice(window.currentInvoiceId);
            }
        }

        function emailCurrentInvoice() {
            if (window.currentInvoiceId) {
                const invoice = invoices.find(inv => inv.id === window.currentInvoiceId);
                if (invoice) {
                    const subject = `Invoice ${invoice.invoiceNumber} - Bhoomi`;
                    const body = `Dear ${invoice.farmer.name},\n\nPlease find attached your invoice ${invoice.invoiceNumber} for the agricultural byproduct transaction.\n\nInvoice Details:\n- Amount: ₹${invoice.calculations.roundedNetAmount.toFixed(2)}\n- Due Date: ${formatDate(invoice.dueDate)}\n- Status: ${invoice.payment.status}\n\nBest regards,\nBhoomi Team`;
                    
                    const mailtoLink = `mailto:${invoice.farmer.email || ''}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.open(mailtoLink);
                }
            }
        }

        // ====== BULK OPERATIONS FUNCTIONS ======

        // Approve bulk invoices
        function approveBulkInvoices() {
            const selectedInvoices = getSelectedInvoices();
            if (selectedInvoices.length === 0) {
                alert('Please select invoices to approve');
                return;
            }
            
            if (!confirm(`Are you sure you want to approve ${selectedInvoices.length} invoice(s)?`)) return;
            
            let approvedCount = 0;
            selectedInvoices.forEach(invoiceId => {
                const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
                if (invoiceIndex !== -1 && invoices[invoiceIndex].status === 'pending_approval') {
                    invoices[invoiceIndex].status = 'approved';
                    invoices[invoiceIndex].payment.status = 'approved';
                    invoices[invoiceIndex].payment.approvedBy = getCurrentUserId();
                    invoices[invoiceIndex].payment.approvedDate = new Date().toISOString();
                    invoices[invoiceIndex].workflow.step = 2;
                    invoices[invoiceIndex].workflow.steps[1].status = 'completed';
                    invoices[invoiceIndex].workflow.steps[1].date = new Date().toISOString();
                    approvedCount++;
                }
            });
            
            localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
            alert(`${approvedCount} invoice(s) approved successfully!`);
            loadGeneratedInvoices();
        }

        // Mark bulk invoices as paid
        function markBulkAsPaid() {
            const selectedInvoices = getSelectedInvoices();
            if (selectedInvoices.length === 0) {
                alert('Please select invoices to mark as paid');
                return;
            }
            
            if (!confirm(`Are you sure you want to mark ${selectedInvoices.length} invoice(s) as paid?`)) return;
            
            let paidCount = 0;
            selectedInvoices.forEach(invoiceId => {
                const invoiceIndex = invoices.findIndex(inv => inv.id === invoiceId);
                if (invoiceIndex !== -1) {
                    invoices[invoiceIndex].payment.status = 'paid';
                    invoices[invoiceIndex].payment.paidDate = new Date().toISOString();
                    invoices[invoiceIndex].workflow.step = 3;
                    invoices[invoiceIndex].workflow.steps[2].status = 'completed';
                    invoices[invoiceIndex].workflow.steps[2].date = new Date().toISOString();
                    paidCount++;
                }
            });
            
            localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
            alert(`${paidCount} invoice(s) marked as paid successfully!`);
            loadGeneratedInvoices();
        }

        // Download bulk invoices
        function downloadBulkInvoices() {
            const selectedInvoices = getSelectedInvoices();
            if (selectedInvoices.length === 0) {
                alert('Please select invoices to download');
                return;
            }
            
            selectedInvoices.forEach((invoiceId, index) => {
                setTimeout(() => {
                    downloadInvoicePDF(invoiceId);
                }, index * 500); // Stagger downloads to avoid browser blocking
            });
        }

        // Get selected invoice IDs
        function getSelectedInvoices() {
            const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Generate bulk payment report
        function generateBulkPaymentReport() {
            const currentUserId = getCurrentUserId();
            const warehouseInvoices = invoices.filter(invoice => invoice.warehouse.id === currentUserId);
            
            if (warehouseInvoices.length === 0) {
                alert('No invoices found to generate report');
                return;
            }
            
            // Generate CSV report
            let csvContent = "Invoice No,Date,Farmer,Commodity,Quantity,Rate,Gross Amount,GST,TDS,Commission,Net Payable,Status\n";
            
            warehouseInvoices.forEach(invoice => {
                csvContent += [
                    invoice.invoiceNumber,
                    invoice.date,
                    invoice.farmer.name,
                    invoice.commodity.byproductType.replace('-', ' '),
                    `${invoice.commodity.quantity} ${invoice.commodity.quantityUnit}`,
                    invoice.commodity.ratePerUnit.toFixed(2),
                    invoice.calculations.grossAmount.toFixed(2),
                    invoice.calculations.gstAmount.toFixed(2),
                    invoice.calculations.tdsAmount.toFixed(2),
                    invoice.calculations.totalCommission.toFixed(2),
                    invoice.calculations.roundedNetAmount.toFixed(2),
                    invoice.payment.status
                ].join(',') + '\n';
            });
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bhoomi-payment-report-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Send payment reminders
        function sendPaymentReminders() {
            const overdueInvoices = invoices.filter(inv => {
                const dueDate = new Date(inv.dueDate);
                const today = new Date();
                return dueDate < today && inv.payment.status !== 'paid';
            });
            
            if (overdueInvoices.length === 0) {
                alert('No overdue invoices found');
                return;
            }
            
            // Mark overdue invoices
            overdueInvoices.forEach(invoice => {
                const invoiceIndex = invoices.findIndex(inv => inv.id === invoice.id);
                if (invoiceIndex !== -1) {
                    invoices[invoiceIndex].payment.status = 'overdue';
                }
            });
            
            localStorage.setItem('bhoomiInvoices', JSON.stringify(invoices));
            
            alert(`${overdueInvoices.length} invoice(s) marked as overdue. Payment reminders would be sent via SMS/Email.`);
            loadGeneratedInvoices();
        }

        // ====== INTEGRATION WITH EXISTING STOCK MANAGEMENT ======

        // Enhanced acceptStockRequest function with automatic invoice generation
        function acceptStockRequest(requestId) {
            if (!confirm('Are you sure you want to accept this stock request?')) return;
            
            const request = stockRequests.find(r => r.id === requestId);
            if (!request) {
                alert('Stock request not found');
                return;
            }
            
            // Get rate from warehouse
            const ratePerUnit = prompt(`Enter rate per ${request.quantity.split(' ')[1] || 'unit'} (₹):`);
            if (!ratePerUnit || isNaN(parseFloat(ratePerUnit))) {
                alert('Please enter a valid rate');
                return;
            }
            
            try {
                // Get current warehouse data
                const currentUserId = getCurrentUserId();
                const warehouseData = {
                    id: currentUserId,
                    companyName: 'Green Valley Storage', // Default - should be from user profile
                    gstin: '24ABCDE1234F1Z5',
                    address: 'Punjab, India',
                    contact: '+91-9876543210',
                    email: 'warehouse@example.com'
                };
                
                // Get farmer data
                const farmerData = {
                    fullName: request.farmerName,
                    address: 'Farmer Address, Punjab, India',
                    mobile: '+91-9876543211',
                    aadhaar: 'XXXX-XXXX-1234',
                    panCard: 'ABCDE1234F',
                    bankAccount: 'XXXXXX1234',
                    ifscCode: 'SBIN0001234',
                    bankName: 'State Bank of India',
                    gstNumber: null, // Will be determined by turnover
                    annualTurnover: 2000000 // ₹20L - below GST exemption limit
                };
                
                // Generate comprehensive invoice
                const invoice = generateComprehensiveInvoice(request, warehouseData, farmerData, parseFloat(ratePerUnit));
                
                // Update stock request status
                const requestIndex = stockRequests.findIndex(r => r.id === requestId);
                if (requestIndex !== -1) {
                    stockRequests[requestIndex].status = 'accepted';
                    stockRequests[requestIndex].warehouseResponse = {
                        message: 'Your stock request has been accepted. Invoice generated.',
                        responseDate: new Date().toISOString(),
                        action: 'accepted',
                        ratePerUnit: parseFloat(ratePerUnit),
                        invoiceId: invoice.id,
                        invoiceNumber: invoice.invoiceNumber
                    };
                    localStorage.setItem('bhoomiStockRequests', JSON.stringify(stockRequests));
                }
                
                // Update stock listing if exists
                const listingIndex = stockListings.findIndex(l => l.id === request.stockListingId);
                if (listingIndex !== -1) {
                    stockListings[listingIndex].status = 'accepted';
                    stockListings[listingIndex].warehouseResponse = stockRequests[requestIndex].warehouseResponse;
                    localStorage.setItem('bhoomiStockListings', JSON.stringify(stockListings));
                }
                
                alert(`Stock request accepted successfully!\nInvoice ${invoice.invoiceNumber} has been generated automatically.\nNet payable to farmer: ₹${invoice.calculations.roundedNetAmount.toFixed(2)}`);
                
                // Refresh displays
                if (typeof loadStockRequests === 'function') loadStockRequests();
                if (typeof loadGeneratedInvoices === 'function') loadGeneratedInvoices();
                
            } catch (error) {
                console.error('Error accepting stock request:', error);
                alert('Error generating invoice. Please try again.');
            }
        }

        // Enhanced reject function
        function rejectStockRequest(requestId) {
            const reason = prompt('Please provide a reason for rejection (optional):');
            if (reason === null) return; // User cancelled
            
            const request = stockRequests.find(r => r.id === requestId);
            if (!request) {
                alert('Stock request not found');
                return;
            }
            
            // Update request status
            const requestIndex = stockRequests.findIndex(r => r.id === requestId);
            if (requestIndex !== -1) {
                stockRequests[requestIndex].status = 'rejected';
                stockRequests[requestIndex].warehouseResponse = {
                    message: reason || 'Request rejected',
                    responseDate: new Date().toISOString(),
                    action: 'rejected',
                    reason: reason || 'No reason provided'
                };
                localStorage.setItem('bhoomiStockRequests', JSON.stringify(stockRequests));
            }
            
            // Update stock listing if exists
            const listingIndex = stockListings.findIndex(l => l.id === request.stockListingId);
            if (listingIndex !== -1) {
                stockListings[listingIndex].status = 'rejected';
                stockListings[listingIndex].warehouseResponse = stockRequests[requestIndex].warehouseResponse;
                localStorage.setItem('bhoomiStockListings', JSON.stringify(stockListings));
            }
            
            alert('Stock request rejected successfully');
            if (typeof loadStockRequests === 'function') loadStockRequests();
        }

        // ====== MISSING UTILITY FUNCTIONS ======

        // Generate unique ID
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Get current user ID
        function getCurrentUserId() {
            const session = JSON.parse(localStorage.getItem('bhoomiUserSession') || '{}');
            return session.email || session.userId || 'demo-user';
        }

        // Get current user data
        function getCurrentUserData() {
            const session = JSON.parse(localStorage.getItem('bhoomiUserSession') || '{}');
            return session.userData || {};
        }

        // Capitalize first letter
        function capitalizeFirst(str) {
            if (!str) return '';
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        // Enhanced showMyInvoices function
        function showMyInvoices() {
            hideAllSections();
            document.getElementById('my-invoices-section').style.display = 'block';
            loadMyInvoices();
        }

        // Enhanced showGeneratedInvoices function
        function showGeneratedInvoices() {
            hideAllSections();
            document.getElementById('generated-invoices-section').style.display = 'block';
            loadGeneratedInvoices();
        }

        // Hide all sections utility
        function hideAllSections() {
            const sections = [
                'stock-form-section', 'my-listings-section', 'stock-requests-section', 
                'dual-management-section', 'requirement-form-section', 'my-requirements-section', 
                'my-invoices-section', 'generated-invoices-section', 'storage-rental-form-section', 
                'my-storage-rentals-section', 'storage-rental-management-section', 'export-management-section',
                'warehouse-directory-section', 'partnership-management-section', 'analytics-section',
                'invoice-details-modal'
            ];
            sections.forEach(section => {
                const element = document.getElementById(section);
                if (element) element.style.display = 'none';
            });
        }

        // ====== SEARCH AND FILTER FUNCTIONS ======

        // Search invoices
        document.addEventListener('DOMContentLoaded', function() {
            const searchInvoices = document.getElementById('searchInvoices');
            const filterInvoiceStatus = document.getElementById('filterInvoiceStatus');
            const searchGeneratedInvoices = document.getElementById('searchGeneratedInvoices');
            const filterGeneratedInvoiceStatus = document.getElementById('filterGeneratedInvoiceStatus');
            
            if (searchInvoices) {
                searchInvoices.addEventListener('input', filterMyInvoices);
            }
            
            if (filterInvoiceStatus) {
                filterInvoiceStatus.addEventListener('change', filterMyInvoices);
            }
            
            if (searchGeneratedInvoices) {
                searchGeneratedInvoices.addEventListener('input', filterGeneratedInvoices);
            }
            
            if (filterGeneratedInvoiceStatus) {
                filterGeneratedInvoiceStatus.addEventListener('change', filterGeneratedInvoices);
            }
        });

        function filterMyInvoices() {
            const searchTerm = document.getElementById('searchInvoices')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('filterInvoiceStatus')?.value || '';
            
            const currentUserId = getCurrentUserId();
            let filteredInvoices = invoices.filter(invoice => invoice.farmer.id === currentUserId);
            
            if (searchTerm) {
                filteredInvoices = filteredInvoices.filter(invoice =>
                    invoice.invoiceNumber.toLowerCase().includes(searchTerm) ||
                    invoice.warehouse.companyName.toLowerCase().includes(searchTerm) ||
                    invoice.commodity.byproductType.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredInvoices = filteredInvoices.filter(invoice => 
                    invoice.payment.status === statusFilter
                );
            }
            
            displayFilteredInvoices(filteredInvoices, 'myInvoicesTable', 'farmer');
        }

        function filterGeneratedInvoices() {
            const searchTerm = document.getElementById('searchGeneratedInvoices')?.value.toLowerCase() || '';
            const statusFilter = document.getElementById('filterGeneratedInvoiceStatus')?.value || '';
            
            const currentUserId = getCurrentUserId();
            let filteredInvoices = invoices.filter(invoice => invoice.warehouse.id === currentUserId);
            
            if (searchTerm) {
                filteredInvoices = filteredInvoices.filter(invoice =>
                    invoice.invoiceNumber.toLowerCase().includes(searchTerm) ||
                    invoice.farmer.name.toLowerCase().includes(searchTerm) ||
                    invoice.commodity.byproductType.toLowerCase().includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredInvoices = filteredInvoices.filter(invoice => 
                    invoice.payment.status === statusFilter
                );
            }
            
            displayFilteredInvoices(filteredInvoices, 'generatedInvoicesTable', 'warehouse');
        }

        function displayFilteredInvoices(invoiceList, tableId, type) {
            const tableBody = document.getElementById(tableId);
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (invoiceList.length === 0) {
                const colSpan = type === 'farmer' ? '13' : '13';
                tableBody.innerHTML = `<tr><td colspan="${colSpan}" class="text-center">No invoices found</td></tr>`;
                return;
            }
            
            if (type === 'farmer') {
                invoiceList.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${invoice.invoiceNumber}</strong></td>
                        <td>${formatDate(invoice.date)}</td>
                        <td>${invoice.warehouse.companyName}</td>
                        <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                        <td>${invoice.commodity.quantity} ${invoice.commodity.quantityUnit}</td>
                        <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                        <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.gstAmount.toFixed(2)} (${invoice.calculations.gstRate}%)</td>
                        <td>₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.totalCommission.toFixed(2)}</td>
                        <td><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                        <td><span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewInvoiceDetails('${invoice.id}')" title="View Details">
                                    <i class="icofont-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="downloadInvoicePDF('${invoice.id}')" title="Download PDF">
                                    <i class="icofont-download"></i>
                                </button>
                                <button class="btn btn-outline-info" onclick="printInvoice('${invoice.id}')" title="Print">
                                    <i class="icofont-printer"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                invoiceList.forEach(invoice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="invoice-checkbox" value="${invoice.id}">
                            <strong>${invoice.invoiceNumber}</strong>
                        </td>
                        <td>${formatDate(invoice.date)}</td>
                        <td>${invoice.farmer.name}</td>
                        <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                        <td>${invoice.commodity.quantity} ${invoice.commodity.quantityUnit}</td>
                        <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                        <td>₹${invoice.calculations.grossAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.gstAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.tdsAmount.toFixed(2)}</td>
                        <td>₹${invoice.calculations.totalCommission.toFixed(2)}</td>
                        <td><strong>₹${invoice.calculations.roundedNetAmount.toFixed(2)}</strong></td>
                        <td><span class="badge ${getPaymentStatusBadgeClass(invoice.payment.status)}">${capitalizeFirst(invoice.payment.status)}</span></td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="viewInvoiceDetails('${invoice.id}')" title="View Details">
                                    <i class="icofont-eye"></i>
                                </button>
                                ${invoice.status === 'pending_approval' ? `
                                    <button class="btn btn-outline-success" onclick="approveInvoice('${invoice.id}')" title="Approve">
                                        <i class="icofont-check"></i>
                                    </button>
                                ` : ''}
                                <button class="btn btn-outline-info" onclick="updatePaymentStatus('${invoice.id}')" title="Update Payment">
                                    <i class="icofont-money"></i>
                                </button>
                                <button class="btn btn-outline-secondary" onclick="downloadInvoicePDF('${invoice.id}')" title="Download">
                                    <i class="icofont-download"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            updateInvoiceSummary(invoiceList, type);
        }

        // Stock Management System
        let stockListings = JSON.parse(localStorage.getItem('bhoomiStockListings') || '[]');
        let stockRequests = JSON.parse(localStorage.getItem('bhoomiStockRequests') || '[]');
        
        // Requirement Management System
        let industryRequirements = JSON.parse(localStorage.getItem('bhoomiIndustryRequirements') || '[]');
        let requirementQuotes = JSON.parse(localStorage.getItem('bhoomiRequirementQuotes') || '[]');
        
        // Enhanced Invoice Management System
        let invoices = JSON.parse(localStorage.getItem('bhoomiInvoices') || '[]');
        let invoiceCounter = parseInt(localStorage.getItem('bhoomiInvoiceCounter') || '1000');
        let farmerProfiles = JSON.parse(localStorage.getItem('bhoomifarmerProfiles') || '[]');
        let warehouseProfiles = JSON.parse(localStorage.getItem('bhoomiWarehouseProfiles') || '[]');
        
        // GST and Tax Configuration
        const GST_RATES = {
            'rice-husk': 5,
            'wheat-straw': 5,
            'sugarcane-bagasse': 5,
            'corn-stalks': 5,
            'cotton-stalks': 12,
            'coconut-coir': 12,
            'mustard-husk': 5,
            'soybean-meal': 5,
            'other': 12
        };
        
        const COMMISSION_RATES = {
            'basic': 5,
            'premium': 7,
            'enterprise': 10
        };
        
        const TDS_THRESHOLD = 30000; // ₹30,000
        const TDS_RATE = 0.01; // 1% TDS
        const GST_EXEMPTION_LIMIT = 4000000; // ₹40L annual turnover
        const COMMISSION_GST_RATE = 18; // 18% GST on commission
        
        // Storage Rental Management System
        let storageRentalRequests = JSON.parse(localStorage.getItem('bhoomiStorageRentalRequests') || '[]');
        let activeStorageRentals = JSON.parse(localStorage.getItem('bhoomiActiveStorageRentals') || '[]');
        let rentalInvoices = JSON.parse(localStorage.getItem('bhoomiRentalInvoices') || '[]');
        let rentalInvoiceCounter = parseInt(localStorage.getItem('bhoomiRentalInvoiceCounter') || '2000');
        
        // Export Management System
        let exportOrders = JSON.parse(localStorage.getItem('bhoomiExportOrders') || '[]');
        let exportDocuments = JSON.parse(localStorage.getItem('bhoomiExportDocuments') || '[]');
        let exportOrderCounter = parseInt(localStorage.getItem('bhoomiExportOrderCounter') || '3000');
        let exportInvoiceCounter = parseInt(localStorage.getItem('bhoomiExportInvoiceCounter') || '4000');
        
        // Gemini API Configuration - Load from external config file
        // Make sure to include gemini-config.js in your HTML head section
        // <script src="gemini-config.js"></script>

       
                <div class="bg-light padding30 rounded-1">
                    <h4 class="mb-4">Find Warehouses</h4>
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h5>Nearby Warehouses</h5>
                                <p>Find warehouses in your area</p>
                                <button class="btn-main btn-line" onclick="searchNearbyWarehouses()">Search Nearby</button>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h5>Storage Partners</h5>
                                <p>Connect with storage partners</p>
                                <button class="btn-main btn-line" onclick="viewStoragePartners()">View Partners</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <h6>Available Warehouses</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Warehouse Name</th>
                                        <th>Location</th>
                                        <th>Storage Capacity</th>
                                        <th>Specialization</th>
                                        <th>Contact</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="warehousesTable">
                                    <tr>
                                        <td>Green Valley Storage</td>
                                        <td>Punjab, India</td>
                                        <td>5000 MT</td>
                                        <td>Rice & Wheat</td>
                                        <td>+91 9876543210</td>
                                        <td><button class="btn btn-sm btn-primary" onclick="contactWarehouse('Green Valley Storage')">Contact</button></td>
                                    </tr>
                                    <tr>
                                        <td>Agri Storage Solutions</td>
                                        <td>Haryana, India</td>
                                        <td>8000 MT</td>
                                        <td>All Crops</td>
                                        <td>+91 9876543211</td>
                                        <td><button class="btn btn-sm btn-primary" onclick="contactWarehouse('Agri Storage Solutions')">Contact</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
           <tr><td colspan="7" class="text-center">No listings found</td></tr>';
                    
                        <td>${capitalizeFirst(listing.cropType)}</td>
                        <td>${capitalizeFirst(listing.byproductType.replace('-', ' '))}</td>
                        <td>${listing.quantity} ${listing.quantityUnit}</td>
                        <td>${capitalizeFirst(listing.qualityGrade)}</td>
                        <td>₹${listing.minPrice} - ₹${listing.maxPrice}</td>
                        <td><span class="badge ${getStatusBadgeClass(listing.status)}">${capitalizeFirst(listing.status)}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewListingDetails('${listing.id}')">View</button>
                            ${listing.status === 'rejected' ? `<button class="btn btn-sm btn-outline-success" onclick="reapplyListing('${listing.id}')">Reapply</button>` : ''}
                        </td>
                   
                <div class="bg-light padding30 rounded-1">
                    <h4 class="mb-4">Partnership Management</h4>
                    <div class="row g-4">
                        <div class="col-md-4">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h5>New Partnerships</h5>
                                <p>Connect with farmers and manufacturers</p>
                                <button class="btn-main btn-line" onclick="createNewPartnership()">Create Partnership</button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h5>Active Partners</h5>
                                <p>Manage existing partnerships</p>
                                <button class="btn-main btn-line" onclick="viewActivePartners()">View Partners</button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h5>Partnership Analytics</h5>
                                <p>Track partnership performance</p>
                                <button class="btn-main btn-line" onclick="viewPartnershipAnalytics()">View Analytics</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <h6>Recent Partnership Requests</h6>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Partner Type</th>
                                        <th>Company/Name</th>
                                        <th>Location</th>
                                        <th>Specialization</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="partnershipRequestsTable">
                                    <tr>
                                        <td>Farmer</td>
                                        <td>Rajesh Kumar</td>
                                        <td>Punjab, India</td>
                                        <td>Rice & Wheat</td>
                                        <td><span class="badge bg-warning">Pending</span></td>
                                        <td><button class="btn btn-sm btn-success" onclick="acceptPartnership('1')">Accept</button></td>
                                    </tr>
                                    <tr>
                                        <td>Manufacturer</td>
                                        <td>AgriTech Industries</td>
                                        <td>Gujarat, India</td>
                                        <td>Biofuel Production</td>
                                        <td><span class="badge bg-info">Under Review</span></td>
                                        <td><button class="btn btn-sm btn-primary" onclick="reviewPartnership('2')">Review</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            
               <tr><td colspan="9" class="text-center">No stock requests found</td></tr>';

            
            
                    <td>${request.farmerName}</td>
                    <td>${capitalizeFirst(request.cropType)}</td>
                    <td>${capitalizeFirst(request.byproductType.replace('-', ' '))}</td>
                    <td>${request.quantity}</td>
                    <td>${capitalizeFirst(request.qualityGrade)}</td>
                    <td>${request.storageLocation}</td>
                    <td>${request.priceRange}</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${capitalizeFirst(request.status)}</span></td>
                    <td>
                        ${request.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="acceptStockRequest('${request.id}')">Accept & Invite</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectStockRequest('${request.id}')">Reject</button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRequestDetails('${request.id}')">View Details</button>
                        `}
                    </td>
              <tr><td colspan="9" class="text-center">No matching requests found</td></tr>';
               
                    <td>${request.farmerName}</td>
                    <td>${capitalizeFirst(request.cropType)}</td>
                    <td>${capitalizeFirst(request.byproductType.replace('-', ' '))}</td>
                    <td>${request.quantity}</td>
                    <td>${capitalizeFirst(request.qualityGrade)}</td>
                    <td>${request.storageLocation}</td>
                    <td>${request.priceRange}</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${capitalizeFirst(request.status)}</span></td>
                    <td>
                        ${request.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="acceptStockRequest('${request.id}')">Accept & Invite</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectStockRequest('${request.id}')">Reject</button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRequestDetails('${request.id}')">View Details</button>
                        `}
                    </td>
            
                <div class="bg-light padding30 rounded-1">
                    <h4 class="mb-4">Sourcing Analytics</h4>
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h3 class="text-color" id="totalSuppliers">0</h3>
                                <p class="mb-0">Active Suppliers</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h3 class="text-color" id="totalOrders">0</h3>
                                <p class="mb-0">Total Orders</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h3 class="text-color" id="avgOrderValue">₹0</h3>
                                <p class="mb-0">Avg Order Value</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="bg-color text-light padding30 rounded-1 text-center">
                                <h3 class="text-color" id="savingsGenerated">₹0</h3>
                                <p class="mb-0">Cost Savings</p>
                            </div>
                        </div>
                    </div>
                    <div class="row g-4">
                        <div class="col-md-6">
                            <h6>Top Suppliers by Volume</h6>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Supplier</th>
                                            <th>Material Type</th>
                                            <th>Volume (MT)</th>
                                            <th>Rating</th>
                                        </tr>
                                    </thead>
                                    <tbody id="topSuppliersTable">
                                        <tr>
                                            <td>Green Valley Storage</td>
                                            <td>Rice Husk</td>
                                            <td>150</td>
                                            <td>⭐⭐⭐⭐⭐</td>
                                        </tr>
                                        <tr>
                                            <td>Agri Storage Solutions</td>
                                            <td>Wheat Straw</td>
                                            <td>120</td>
                                            <td>⭐⭐⭐⭐</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Material Sourcing Trends</h6>
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Material</th>
                                            <th>Demand</th>
                                            <th>Price Trend</th>
                                            <th>Availability</th>
                                        </tr>
                                    </thead>
                                    <tbody id="materialTrendsTable">
                                        <tr>
                                            <td>Rice Husk</td>
                                            <td>High</td>
                                            <td>↗️ Rising</td>
                                            <td>Good</td>
                                        </tr>
                                        <tr>
                                            <td>Wheat Straw</td>
                                            <td>Medium</td>
                                            <td>→ Stable</td>
                                            <td>Good</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
          <tr><td colspan="8" class="text-center">No requirements found</td></tr>';
            
                    <td>${capitalizeFirst(requirement.materialType.replace('-', ' '))}</td>
                    <td>${requirement.quantity} ${requirement.quantityUnit}</td>
                    <td>${capitalizeFirst(requirement.qualitySpecs)}</td>
                    <td>${requirement.deliveryDate}</td>
                    <td>₹${requirement.minBudget} - ₹${requirement.maxBudget}</td>
                    <td><span class="badge ${getUrgencyBadgeClass(requirement.urgencyLevel)}">${capitalizeFirst(requirement.urgencyLevel)}</span></td>
                    <td><span class="badge ${getStatusBadgeClass(requirement.status)}">${capitalizeFirst(requirement.status)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewRequirementDetails('${requirement.id}')">View</button>
                        ${requirement.status === 'rejected' ? `<button class="btn btn-sm btn-outline-success" onclick="resubmitRequirement('${requirement.id}')">Resubmit</button>` : ''}
                        ${requirement.quote ? `<button class="btn btn-sm btn-outline-info" onclick="viewQuote('${requirement.id}')">Quote</button>` : ''}
                    </td>
            <tr><td colspan="9" class="text-center">No industry requirements found</td></tr>';
               
                    <td>${requirement.companyName}</td>
                    <td>${capitalizeFirst(requirement.materialType.replace('-', ' '))}</td>
                    <td>${requirement.quantity} ${requirement.quantityUnit}</td>
                    <td>${capitalizeFirst(requirement.qualitySpecs)}</td>
                    <td>${requirement.deliveryDate}</td>
                    <td>₹${requirement.minBudget} - ₹${requirement.maxBudget}</td>
                    <td><span class="badge ${getUrgencyBadgeClass(requirement.urgencyLevel)}">${capitalizeFirst(requirement.urgencyLevel)}</span></td>
                    <td><span class="badge ${getStatusBadgeClass(requirement.status)}">${capitalizeFirst(requirement.status)}</span></td>
                    <td>
                        ${requirement.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="acceptRequirement('${requirement.id}')">Accept & Quote</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectRequirement('${requirement.id}')">Reject</button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRequirementDetails('${requirement.id}')">View Details</button>
                        `}
                    </td>
                <tr><td colspan="9" class="text-center">No matching requirements found</td></tr>';
                return;
            }
            
          
                    <td>${requirement.companyName}</td>
                    <td>${capitalizeFirst(requirement.materialType.replace('-', ' '))}</td>
                    <td>${requirement.quantity} ${requirement.quantityUnit}</td>
                    <td>${capitalizeFirst(requirement.qualitySpecs)}</td>
                    <td>${requirement.deliveryDate}</td>
                    <td>₹${requirement.minBudget} - ₹${requirement.maxBudget}</td>
                    <td><span class="badge ${getUrgencyBadgeClass(requirement.urgencyLevel)}">${capitalizeFirst(requirement.urgencyLevel)}</span></td>
                    <td><span class="badge ${getStatusBadgeClass(requirement.status)}">${capitalizeFirst(requirement.status)}</span></td>
                    <td>
                        ${requirement.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="acceptRequirement('${requirement.id}')">Accept & Quote</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectRequirement('${requirement.id}')">Reject</button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRequirementDetails('${requirement.id}')">View Details</button>
                        `}
                    </td>
              <tr><td colspan="8" class="text-center">No invoices found</td></tr>';
               
                    <td>${invoice.invoiceNumber}</td>
                    <td>${invoice.date}</td>
                    <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                    <td>${invoice.commodity.quantity} ${invoice.commodity.unit}</td>
                    <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                    <td>₹${invoice.calculations.taxableAmount.toFixed(2)}</td>
                    <td><span class="badge ${getPaymentStatusBadgeClass(invoice.paymentStatus)}">${capitalizeFirst(invoice.paymentStatus)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewInvoice('${invoice.id}')">View</button>
                        <button class="btn btn-sm btn-outline-success" onclick="downloadInvoice('${invoice.id}')">Download</button>
                        <button class="btn btn-sm btn-outline-info" onclick="printInvoice('${invoice.id}')">Print</button>
                    </td>
                <tr><td colspan="10" class="text-center">No invoices found</td></tr>';
            
                    <td>${invoice.invoiceNumber}</td>
                    <td>${invoice.date}</td>
                    <td>${invoice.farmerDetails.name}</td>
                    <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                    <td>${invoice.commodity.quantity} ${invoice.commodity.unit}</td>
                    <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                    <td>₹${invoice.calculations.taxableAmount.toFixed(2)}</td>
                    <td>₹${invoice.calculations.commissionAmount.toFixed(2)}</td>
                    <td><span class="badge ${getPaymentStatusBadgeClass(invoice.paymentStatus)}">${capitalizeFirst(invoice.paymentStatus)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewInvoice('${invoice.id}')">View</button>
                        <button class="btn btn-sm btn-outline-success" onclick="updatePaymentStatus('${invoice.id}')">Update Payment</button>
                        <button class="btn btn-sm btn-outline-info" onclick="downloadInvoice('${invoice.id}')">Download</button>
                    </td>
             
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${invoice.invoiceNumber}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .invoice-details { margin-bottom: 20px; }
                        .parties { display: flex; justify-content: space-between; margin-bottom: 20px; }
                        .party { width: 45%; }
                        .commodity-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        .commodity-table th, .commodity-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .calculations { margin-top: 20px; }
                        .total { font-weight: bold; font-size: 18px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>BHOOMI AGRICULTURAL MARKETPLACE</h1>
                        <h2>INVOICE</h2>
                    </div>
                    
                    <div class="invoice-details">
                        <p><strong>Invoice No:</strong> ${invoice.invoiceNumber}</p>
                        <p><strong>Date:</strong> ${invoice.date}</p>
                        <p><strong>Due Date:</strong> ${invoice.dueDate}</p>
                    </div>
                    
                    <div class="parties">
                        <div class="party">
                            <h3>Farmer Details</h3>
                            <p>${invoice.farmerDetails.name}</p>
                            <p>${invoice.farmerDetails.address}</p>
                            <p>Mobile: ${invoice.farmerDetails.mobile}</p>
                            <p>Aadhaar: ${invoice.farmerDetails.aadhaar}</p>
                        </div>
                        <div class="party">
                            <h3>Warehouse Details</h3>
                            <p>${invoice.warehouseDetails.companyName}</p>
                            <p>GSTIN: ${invoice.warehouseDetails.gstin}</p>
                            <p>${invoice.warehouseDetails.address}</p>
                            <p>Contact: ${invoice.warehouseDetails.contact}</p>
                        </div>
                    </div>
                    
                    <table class="commodity-table">
                        <thead>
                            <tr>
                                <th>Commodity</th>
                                <th>Quantity</th>
                                <th>Rate per Unit</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>${capitalizeFirst(invoice.commodity.byproductType.replace('-', ' '))}</td>
                                <td>${invoice.commodity.quantity} ${invoice.commodity.unit}</td>
                                <td>₹${invoice.commodity.ratePerUnit.toFixed(2)}</td>
                                <td>₹${invoice.calculations.taxableAmount.toFixed(2)}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="calculations">
                        <p>Taxable Amount: ₹${invoice.calculations.taxableAmount.toFixed(2)}</p>
                        <p>GST (${invoice.calculations.gstRate}%): ₹${invoice.calculations.gstAmount.toFixed(2)}</p>
                        <p>Platform Commission (${invoice.calculations.commissionRate}%): ₹${invoice.calculations.commissionAmount.toFixed(2)}</p>
                        <p>Commission GST (18%): ₹${invoice.calculations.commissionGST.toFixed(2)}</p>
                        <p>TDS (${(invoice.calculations.tdsRate * 100).toFixed(1)}%): ₹${invoice.calculations.tdsAmount.toFixed(2)}</p>
                        <p class="total">Net Amount Payable: ₹${invoice.calculations.netAmount.toFixed(2)}</p>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <p><strong>Payment Status:</strong> ${capitalizeFirst(invoice.paymentStatus)}</p>
                        ${invoice.paymentDate ? `<p><strong>Payment Date:</strong> ${invoice.paymentDate}</p>` : ''}
                        ${invoice.paymentMethod ? `<p><strong>Payment Method:</strong> ${invoice.paymentMethod}</p>` : ''}
                        ${invoice.transactionId ? `<p><strong>Transaction ID:</strong> ${invoice.transactionId}</p>` : ''}
                    </div>
                </body>
                </html>
            <tr><td colspan="8" class="text-center">No rental requests found</td></tr>';
              
                    <td>${request.farmerName}</td>
                    <td>${capitalizeFirst(request.commodityType.replace('-', ' '))}</td>
                    <td>${request.storageArea} ${request.areaUnit}</td>
                    <td>${request.duration} ${request.durationUnit}</td>
                    <td>${request.startDate}</td>
                    <td>₹${request.budget}/month</td>
                    <td><span class="badge ${getStatusBadgeClass(request.status)}">${capitalizeFirst(request.status)}</span></td>
                    <td>
                        ${request.status === 'pending' ? `
                            <button class="btn btn-sm btn-success" onclick="acceptRentalRequest('${request.id}')">Accept & Quote</button>
                            <button class="btn btn-sm btn-danger" onclick="rejectRentalRequest('${request.id}')">Reject</button>
                        ` : `
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRentalRequestDetails('${request.id}')">View Details</button>
                        `}
                    </td>
               <tr><td colspan="8" class="text-center">No active rentals found</td></tr>';
                
                    <td>${rental.rentalId}</td>
                    <td>${rental.farmerName}</td>
                    <td>${capitalizeFirst(rental.commodityType.replace('-', ' '))}</td>
                    <td>${rental.storageArea} ${rental.areaUnit}</td>
                    <td>₹${rental.monthlyRate.toFixed(2)}</td>
                    <td>${rental.endDate}</td>
                    <td><span class="badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewRentalDetails('${rental.id}')">View</button>
                        <button class="btn btn-sm btn-outline-success" onclick="renewRental('${rental.id}')">Renew</button>
                        <button class="btn btn-sm btn-outline-info" onclick="generateRentalInvoice('${rental.id}')">Invoice</button>
             <tr><td colspan="8" class="text-center">No storage rentals found</td></tr>';
                
                    <td>${rental.rentalId}</td>
                    <td>${capitalizeFirst(rental.commodityType.replace('-', ' '))}</td>
                    <td>${rental.storageArea} ${rental.areaUnit}</td>
                    <td>${rental.duration} ${rental.durationUnit}</td>
                    <td>${rental.startDate}</td>
                    <td>₹${rental.monthlyRate.toFixed(2)}</td>
                    <td><span class="badge ${getStatusBadgeClass(rental.status)}">${capitalizeFirst(rental.status)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewRentalDetails('${rental.id}')">View</button>
                        <button class="btn btn-sm btn-outline-success" onclick="renewRental('${rental.id}')">Renew</button>
                    </td>
              <tr><td colspan="8" class="text-center">No rental income found</td></tr>';
               
                    <td>${rental.rentalId}</td>
                    <td>${rental.farmerName}</td>
                    <td>${capitalizeFirst(rental.commodityType.replace('-', ' '))}</td>
                    <td>${rental.storageArea} ${rental.areaUnit}</td>
                    <td>₹${rental.monthlyRate.toFixed(2)}</td>
                    <td>₹${totalRevenue.toFixed(2)}</td>
                    <td>₹${commission.toFixed(2)}</td>
                    <td>₹${netIncome.toFixed(2)}</td>
              <tr><td colspan="8" class="text-center">No export orders found</td></tr>';
             
                    <td>${order.orderNumber}</td>
                    <td>${order.buyerCompany}</td>
                    <td>${capitalizeFirst(order.commodityType.replace('-', ' '))}</td>
                    <td>${order.quantity} ${order.quantityUnit}</td>
                    <td>${order.currency} ${order.totalValue.toFixed(2)}</td>
                    <td>${order.buyerCountry}</td>
                    <td><span class="badge ${getExportStatusBadgeClass(order.status)}">${capitalizeFirst(order.status)}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewExportOrder('${order.id}')">View</button>
                        <button class="btn btn-sm btn-outline-success" onclick="updateExportStatus('${order.id}')">Update Status</button>
                        <button class="btn btn-sm btn-outline-info" onclick="generateExportDocuments('${order.id}')">Documents</button>
                    </td>
               <tr><td colspan="6" class="text-center">No export data found</td></tr>';
                
                    <td>${order.orderNumber}</td>
                    <td>${order.buyerCountry}</td>
                    <td>${capitalizeFirst(order.commodityType.replace('-', ' '))}</td>
                    <td>${order.currency} ${order.totalValue.toFixed(2)}</td>
                    <td><span class="badge ${getExportStatusBadgeClass(order.status)}">${capitalizeFirst(order.status)}</span></td>
                    <td><span class="badge ${getComplianceScoreBadgeClass(order.complianceScore)}">${order.complianceScore}%</span></td>
               <div class="text-center"><i class="icofont-spinner icofont-spin"></i> Running AI compliance check...</div>';
            
           
                <div class="compliance-results">
                    <h6>AI Compliance Analysis Results</h6>
                    <div class="mb-3">
                        <strong>Export Allowed:</strong> 
                        <span class="badge ${results.allowed ? 'bg-success' : 'bg-danger'}">
                            ${results.allowed ? 'Yes' : 'No'}
                        </span>
                    </div>
                    <div class="mb-3">
                        <strong>Estimated Duties:</strong> ${results.duties}
                    </div>
                    <div class="mb-3">
                        <strong>Required Certificates:</strong>
                        <ul class="mb-0">
                            ${results.requirements.map(req => `<li>${req}</li>`).join('')}
                        </ul>
                    </div>
                    <div class="mb-3">
                        <strong>Restrictions:</strong> ${results.restrictions}
                    </div>
                    <div class="mb-3">
                        <strong>Compliance Score:</strong> 
                        <span class="badge ${getComplianceScoreBadgeClass(results.complianceScore)}">
                            ${results.complianceScore}%
                        </span>
                    </div>
            
                    <div class="mb-3">
                        <strong>Potential Issues:</strong>
                        
                    </div>
               </div>';
          <div class="text-center"><i class="icofont-spinner icofont-spin"></i> Checking documentation requirements...</div>';
            
          
                <div class="duty-results">
                    <h6>Import Duty Calculation Results</h6>
                    <div class="mb-3">
                        <strong>Basic Duty Rate:</strong> ${results.basicDuty}%
                    </div>
                    <div class="mb-3">
                        <strong>Additional Duties:</strong> ${results.additionalDuties || 'None'}
                    </div>
                    <div class="mb-3">
                        <strong>Total Duty Rate:</strong> 
                        <span class="badge bg-warning">${results.totalDuty.percentage}%</span>
                    </div>
                    <div class="mb-3">
                        <strong>Total Duty Amount:</strong> 
                        <span class="badge bg-info">$${totalDutyAmount.toFixed(2)}</span>
                    </div>
                    <div class="mb-3">
                        <strong>Preferential Rates:</strong> ${results.preferentialRates || 'None available'}
                    </div>
                    <div class="mb-3">
                        <strong>Documentation for Duty Benefits:</strong>
                        <ul class="mb-0">
                            ${results.documentationRequirements.map(req => `<li>${req}</li>`).join('')}
                        </ul>
                    </div>
                </div>
        
                <div class="documentation-results">
                    <h6>Export Documentation Requirements</h6>
                    
                    <div class="mb-3">
                        <strong>Mandatory Certificates:</strong>
                        <ul class="mb-2">
                            ${results.mandatory.map(doc => `<li>${doc}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Optional Documents:</strong>
                        <ul class="mb-2">
                            ${results.optional.map(doc => `<li>${doc}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Specific Requirements:</strong>
                        <ul class="mb-2">
                            ${results.requirements.map(req => `<li>${req}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Validity Periods:</strong>
                        <ul class="mb-2">
                            ${results.validity.map(valid => `<li>${valid}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <strong>Issuing Authorities:</strong>
                        <ul class="mb-0">
                            ${results.authorities.map(auth => `<li>${auth}</li>`).join('')}
                        </ul>
                    </div>
                </div>
          
    </script>
</body>
</html>
